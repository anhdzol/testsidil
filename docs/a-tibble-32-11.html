<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 A tibble: 32 × 11 | SIDIL: Manual del procesamiento y explotación de la información</title>
  <meta name="description" content="Breve descripcion pendiente" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 A tibble: 32 × 11 | SIDIL: Manual del procesamiento y explotación de la información" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Breve descripcion pendiente" />
  <meta name="github-repo" content="anhdzol/testsidil/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 A tibble: 32 × 11 | SIDIL: Manual del procesamiento y explotación de la información" />
  
  <meta name="twitter:description" content="Breve descripcion pendiente" />
  

<meta name="author" content="American Institutes for Research" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="procesamiento.html"/>
<link rel="next" href="presentación-sintética-de-todos-los-scripts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Manual de procesamiento y explotación de información</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> output: word_document</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introalineacion"><i class="fa fa-check"></i><b>1.1</b> Alineación con la misión y programas de gobierno</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#introjustificacion"><i class="fa fa-check"></i><b>1.2</b> Justificación de la viabilidad del proyecto</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#introobjetivos"><i class="fa fa-check"></i><b>1.3</b> Objetivos del SIDIL</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#propuestasolucion"><i class="fa fa-check"></i><b>1.4</b> Propuesta de solución</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#introalcance"><i class="fa fa-check"></i><b>1.5</b> Alcance</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html"><i class="fa fa-check"></i><b>2</b> Estructura y flujos de trabajo del SIDIL</a>
<ul>
<li class="chapter" data-level="2.1" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#elementos-básicos-del-sidil"><i class="fa fa-check"></i><b>2.1</b> Elementos básicos del SIDIL</a></li>
<li class="chapter" data-level="2.2" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#modulosqueconformanSIDIL"><i class="fa fa-check"></i><b>2.2</b> Módulos que conforman el SIDIL</a>
<ul>
<li class="chapter" data-level="" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#moduloIexplicaciongeneral"><i class="fa fa-check"></i>Módulo I: actualización de indicadores</a></li>
<li class="chapter" data-level="" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#moduloIIexplicaciongeneral"><i class="fa fa-check"></i>Módulo II: Consulta al universo de CT, imputación de indicadores y predicción de riesgo</a></li>
<li class="chapter" data-level="" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#moduloIyIIexplicaciongeneral"><i class="fa fa-check"></i>Módulos I y II: operables desde la interfaz de automatización</a></li>
<li class="chapter" data-level="" data-path="estructura-y-flujos-de-trabajo-del-sidil.html"><a href="estructura-y-flujos-de-trabajo-del-sidil.html#moduloIIIIConsultaMPR"><i class="fa fa-check"></i>Módulo III: Consulta de la MPR para priorización de CT a inspeccionar</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="elementosgenerales.html"><a href="elementosgenerales.html"><i class="fa fa-check"></i><b>3</b> Elementos generales del procesamiento de datos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="elementosgenerales.html"><a href="elementosgenerales.html#estructurascripts"><i class="fa fa-check"></i><b>3.1</b> Estructura de Scripts</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="elementosgenerales.html"><a href="elementosgenerales.html#configinicial"><i class="fa fa-check"></i><b>3.1.1</b> Script de configuración inicial y script de funciones y catálogos</a></li>
<li class="chapter" data-level="3.1.2" data-path="elementosgenerales.html"><a href="elementosgenerales.html#secuenciadores"><i class="fa fa-check"></i><b>3.1.2</b> Scripts secuenciadores</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="elementosgenerales.html"><a href="elementosgenerales.html#estructuracarpetas"><i class="fa fa-check"></i><b>3.2</b> Estructura de carpetas y sintaxis de archivos</a></li>
<li class="chapter" data-level="3.3" data-path="elementosgenerales.html"><a href="elementosgenerales.html#temporalidad"><i class="fa fa-check"></i><b>3.3</b> Sobre la temporalidad</a></li>
<li class="chapter" data-level="3.4" data-path="elementosgenerales.html"><a href="elementosgenerales.html#trazabilidad"><i class="fa fa-check"></i><b>3.4</b> Sobre trazabilidad: bitácora, log y parámetros</a></li>
<li class="chapter" data-level="3.5" data-path="elementosgenerales.html"><a href="elementosgenerales.html#mensajesGeneral"><i class="fa fa-check"></i><b>3.5</b> Mensajes al usuario</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="elementosgenerales.html"><a href="elementosgenerales.html#mensajesError.unnumbered"><i class="fa fa-check"></i><b>3.5.1</b> Mensajes de error</a></li>
<li class="chapter" data-level="3.5.2" data-path="elementosgenerales.html"><a href="elementosgenerales.html#mensajesAdvertencia.unnumbered"><i class="fa fa-check"></i><b>3.5.2</b> Mensajes de advertencia</a></li>
<li class="chapter" data-level="3.5.3" data-path="elementosgenerales.html"><a href="elementosgenerales.html#mensajesConfirmacion.unnumbered"><i class="fa fa-check"></i><b>3.5.3</b> Mensajes de información o de confirmación</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="elementosgenerales.html"><a href="elementosgenerales.html#software-para-el-procesamiento-de-datos"><i class="fa fa-check"></i><b>3.6</b> Software para el procesamiento de datos</a></li>
<li class="chapter" data-level="3.7" data-path="elementosgenerales.html"><a href="elementosgenerales.html#catalogos"><i class="fa fa-check"></i><b>3.7</b> Catálogos de información</a></li>
<li class="chapter" data-level="3.8" data-path="elementosgenerales.html"><a href="elementosgenerales.html#la-matriz-de-predicción-de-riesgo"><i class="fa fa-check"></i><b>3.8</b> La Matriz de Predicción de Riesgo</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="procesamiento.html"><a href="procesamiento.html"><i class="fa fa-check"></i><b>4</b> Procesamiento de las fuentes de información y generación de la MPR</a>
<ul>
<li class="chapter" data-level="4.1" data-path="procesamiento.html"><a href="procesamiento.html#procesamientoModI"><i class="fa fa-check"></i><b>4.1</b> Módulo I: actualización de indicadores</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="procesamiento.html"><a href="procesamiento.html#procesamientoModIdesafios"><i class="fa fa-check"></i><b>4.1.1</b> Desafíos al tratamiento de bases de datos externas</a></li>
<li class="chapter" data-level="4.1.2" data-path="procesamiento.html"><a href="procesamiento.html#procesamientoModInivelesagregacion"><i class="fa fa-check"></i><b>4.1.2</b> Sobre niveles de agregación</a></li>
<li class="chapter" data-level="4.1.3" data-path="procesamiento.html"><a href="procesamiento.html#procesamientoModInominativo"><i class="fa fa-check"></i><b>4.1.3</b> Sobre estimaciones puntuales nominativas</a></li>
<li class="chapter" data-level="4.1.4" data-path="procesamiento.html"><a href="procesamiento.html#procesamientoModEspecificaciones"><i class="fa fa-check"></i><b>4.1.4</b> Especificaciones por fuente de información</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html"><i class="fa fa-check"></i><b>5</b> A tibble: 32 × 11</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIcoyvshist"><i class="fa fa-check"></i><b>5.0.1</b> Estimaciones puntuales e históricas de indicadores</a></li>
<li class="chapter" data-level="5.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#moduloii"><i class="fa fa-check"></i><b>5.1</b> Módulo II: imputación de indicadores y generación de la MPR</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#propositomoduloii"><i class="fa fa-check"></i><b>5.1.1</b> Propósito principal</a></li>
<li class="chapter" data-level="5.1.2" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#requisitosmoduloii"><i class="fa fa-check"></i><b>5.1.2</b> Requisitos para la ejecución de este módulo</a></li>
<li class="chapter" data-level="5.1.3" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIIimputacion"><i class="fa fa-check"></i><b>5.1.3</b> Imputación de indicadores laborales al universo de CT</a></li>
<li class="chapter" data-level="5.1.4" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIIprediccion"><i class="fa fa-check"></i><b>5.1.4</b> Predicción de riesgo</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIyIIinterfazAuto"><i class="fa fa-check"></i><b>5.2</b> Interfaz de automatización: Módulos I y II</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#propositointerfaz1"><i class="fa fa-check"></i><b>5.2.1</b> Propósito de la interfaz</a></li>
<li class="chapter" data-level="5.2.2" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#accesointerfaz1"><i class="fa fa-check"></i><b>5.2.2</b> Acceso a la interfaz</a></li>
<li class="chapter" data-level="5.2.3" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#organizacioninterfaz1"><i class="fa fa-check"></i><b>5.2.3</b> Organización de la interfaz</a></li>
<li class="chapter" data-level="" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#interfaz1-8"><i class="fa fa-check"></i>Procesamiento de información</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIIIinterfazConsulta"><i class="fa fa-check"></i><b>5.3</b> Módulo III: Priorización de los centros de trabajo</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#propositointerfaz2"><i class="fa fa-check"></i><b>5.3.1</b> Propósito de la interfaz</a></li>
<li class="chapter" data-level="5.3.2" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#accesointerfaz2"><i class="fa fa-check"></i><b>5.3.2</b> Acceso a la interfaz</a></li>
<li class="chapter" data-level="" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#interfaz2-1"><i class="fa fa-check"></i>Primera prestaña: Filtrado</a></li>
<li class="chapter" data-level="" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#interfaz2-3"><i class="fa fa-check"></i>Segunda pestaña: Analisis</a></li>
<li class="chapter" data-level="" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#interfaz2-4"><i class="fa fa-check"></i>Tabla final de resultados con sus pestañas</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIV"><i class="fa fa-check"></i><b>5.4</b> Módulo IV: Entrenamiento del modelo</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#propositoModIV"><i class="fa fa-check"></i><b>5.4.1</b> Propósito principal</a></li>
<li class="chapter" data-level="5.4.2" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIVSIAPI"><i class="fa fa-check"></i><b>5.4.2</b> Construcción de la serie histórica de inspecciones laborales (2012-2022)</a></li>
<li class="chapter" data-level="5.4.3" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIVindicadores"><i class="fa fa-check"></i><b>5.4.3</b> Construcción de la serie histórica de indicadores laborales</a></li>
<li class="chapter" data-level="5.4.4" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIVmatching"><i class="fa fa-check"></i><b>5.4.4</b> Matching de las series históricas</a></li>
<li class="chapter" data-level="5.4.5" data-path="a-tibble-32-11.html"><a href="a-tibble-32-11.html#procesamientoModIVEntrenamiento"><i class="fa fa-check"></i><b>5.4.5</b> Entrenamiento y evaluación del modelo de predicción</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="presentación-sintética-de-todos-los-scripts.html"><a href="presentación-sintética-de-todos-los-scripts.html"><i class="fa fa-check"></i><b>6</b> Presentación sintética de todos los scripts</a></li>
<li class="chapter" data-level="7" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html"><i class="fa fa-check"></i><b>7</b> R, RStudio y Python</a>
<ul>
<li class="chapter" data-level="7.1" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html#r-y-rstudio"><i class="fa fa-check"></i><b>7.1</b> R y RStudio</a></li>
<li class="chapter" data-level="7.2" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html#el-entorno-de-rstudio"><i class="fa fa-check"></i><b>7.2</b> El entorno de RStudio</a></li>
<li class="chapter" data-level="7.3" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html#procedimiento-para-ejecutar-proyectos-y-scripts-en-rstudio"><i class="fa fa-check"></i><b>7.3</b> Procedimiento para ejecutar proyectos y scripts en RStudio</a></li>
<li class="chapter" data-level="7.4" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html#tipos-de-errores-que-se-pudieran-presentar"><i class="fa fa-check"></i><b>7.4</b> Tipos de errores que se pudieran presentar</a></li>
<li class="chapter" data-level="7.5" data-path="r-rstudio-y-python.html"><a href="r-rstudio-y-python.html#python"><i class="fa fa-check"></i><b>7.5</b> Python</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="especificaciones-del-servidor.html"><a href="especificaciones-del-servidor.html"><i class="fa fa-check"></i><b>8</b> Especificaciones del servidor</a></li>
<li class="chapter" data-level="9" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html"><i class="fa fa-check"></i><b>9</b> Conceptos y hallazgos clave en la exploración del SIAPI-SIPAS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#conceptos-y-clasificaciones-relevantes."><i class="fa fa-check"></i><b>9.1</b> Conceptos y clasificaciones relevantes.</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#planeación-de-la-inspección"><i class="fa fa-check"></i><b>9.1.1</b> Planeación de la inspección</a></li>
<li class="chapter" data-level="9.1.2" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#meta-y-realización-de-inspecciones-a-realizar-por-tipo-estado-y-por-oficina"><i class="fa fa-check"></i><b>9.1.2</b> Meta y realización de inspecciones a realizar por tipo, estado y por oficina</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#alcance-de-la-inspección"><i class="fa fa-check"></i><b>9.2</b> Alcance de la inspección</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#criterios-de-selección-utilizados-antes-del-sidil."><i class="fa fa-check"></i><b>9.2.1</b> Criterios de selección utilizados antes del SIDIL.</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#aspectos-pendientes-y-posibles-extensiones-a-futuro"><i class="fa fa-check"></i><b>9.3</b> Aspectos pendientes y posibles extensiones a futuro</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#limitaciones-en-la-construcción-de-la-variable-dependiente"><i class="fa fa-check"></i><b>9.3.1</b> Limitaciones en la construcción de la variable dependiente</a></li>
<li class="chapter" data-level="9.3.2" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#posibles-alternativas-como-variable-dependiente"><i class="fa fa-check"></i><b>9.3.2</b> Posibles alternativas como variable dependiente</a></li>
<li class="chapter" data-level="9.3.3" data-path="anexoHallazgos.html"><a href="anexoHallazgos.html#section"><i class="fa fa-check"></i><b>9.3.3</b> </a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="box-and-tables.html"><a href="box-and-tables.html"><i class="fa fa-check"></i><b>10</b> Box and tables</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="box-and-tables.html"><a href="box-and-tables.html#tablas"><i class="fa fa-check"></i><b>10.0.1</b> Tablas</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SIDIL: Manual del procesamiento y explotación de la información</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="a-tibble-32-11" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Capítulo 5</span> A tibble: 32 × 11<a href="a-tibble-32-11.html#a-tibble-32-11" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<pre><code> mpg cyl    disp    hp  drat    wt  qsec    vs    am  gear  carb</code></pre>
<p><dbl> <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
1 21 “6” 160 110 3.9 2.62 16.5 0 1 4 4
2 21 “” 160 110 3.9 2.88 17.0 0 1 4 4
3 22.8 “4” 108 93 3.85 2.32 18.6 1 1 4 1
4 21.4 “” 258 110 3.08 3.22 19.4 1 0 3 1
5 18.7 “8” 360 175 3.15 3.44 17.0 0 0 3 2
6 18.1 “” 225 105 2.76 3.46 20.2 1 0 3 1
7 14.3 “” 360 245 3.21 3.57 15.8 0 0 3 4
8 24.4 “” 147. 62 3.69 3.19 20 1 0 4 2
9 22.8 “” 141. 95 3.92 3.15 22.9 1 0 4 2
10 19.2 “” 168. 123 3.92 3.44 18.3 1 0 4 4
# ℹ 22 more rows</p>
<div id="outputimss" class="section level5 unnumbered hasAnchor">
<h5>Salidas - Outputs<a href="a-tibble-32-11.html#outputimss" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Los outputs o resultados esperados finales de la aplicación de los scripts del IMSS son seis archivos <em>.Rds</em> correspondientes a cada uno de los indicadores, los cuales contienen las estimaciones puntuales de los indicadores en los seis niveles de agregación para el último periodo disponible, tomando en consideración que es un promedio móvil de los últimos tres meses disponibles (o lo que determine el usuario).</p>
<p>Estas estimaciones puntuales coyunturales serán el insumo del <em>matching</em> coyuntural, y serán imputadas a los centros de trabajo según el nivel de agregación correspondiente a la información disponible de cada centro de trabajo.</p>
</div>
<div id="procesamientoModICenso" class="section level4 hasAnchor" number="5.0.0.1">
<h4><span class="header-section-number">5.0.0.1</span> El Censo económico<a href="a-tibble-32-11.html#procesamientoModICenso" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El Censo Económico brinda información sobre los establecimientos productores de bienes, comercializadores y prestadores de servicios de manera quinquenal. Dado que se trata de un censo, la información de las unidades económicas cuenta con gran especificidad geográfica, sectorial y temática.</p>
<div id="frecuenciacenso" class="section level5 unnumbered hasAnchor">
<h5>Frecuencia de actualización y propuesta de calendarización<a href="a-tibble-32-11.html#frecuenciacenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Para la construcción de los indicadores se utilizó el censo económico del año 2019. No obstante, no se utilizó la información pública de dicho censo, sino que, siguiendo con la idea de aprovechamiento de la información con la que cuenta la STPS, se utilizaron las tablas del censo que fueron proporcionadas a la STPS directamente por el INEGI y que cuentan con información de las 3 empresas más importantes por municipio y actividad económica (SCIAN a dos dígitos).</p>
<p>Dada esta particularidad sobre la fuente de información no se espera que se actualicen los indicadores próximamente. Si se desean actualizar con la próxima edición del censo, es importante contar con las tablas proporcionadas por el INEGI también actualizadas.</p>
</div>
<div id="indicadorescenso" class="section level5 unnumbered hasAnchor">
<h5>Indicadores que se calculan<a href="a-tibble-32-11.html#indicadorescenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Con el Censo Económico se construyen dos indicadores: subcontratación y concentración de mercado. Ambos se construyen con respecto a las tres empresas más grandes por municipio y actividad económica, por lo que únicamente se calculan a un único nivel de agregación: 3_geo5_act2_tam.</p>
<p>No obstante, es importante notar que no siempre se calculan las estimaciones puntuales por falta de información en el número total de ocupados en alguna de las agregaciones, ya que esta información también cuenta con censura estadística.</p>
<p>En la siguiente tabla se muestra el detalle del cálculo de indicadores.</p>
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-16">Tabla 5.1: </span>Indicadores que se calculan con base en el Censo Económico
</caption>
<thead>
<tr>
<th style="text-align:left;">
Indicador
</th>
<th style="text-align:left;">
Cálculo
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Subcontratación
</td>
<td style="text-align:left;">
Promedio de personas trabajadoras dependientes de otra razón social respecto al total de trabajadores de las tres empresas más grandes por municipio y sector de actividad económica (SCIAN dos dígitos). Este indicador viene en términos porcentuales desde la fuente de datos original. La medida del indicador se guarda como: “promedio_ct3”, lo refiere al promedio de los tres principales centros de trabajo de los niveles ya mencionados.
</td>
</tr>
<tr>
<td style="text-align:left;">
Concentración de mercado
</td>
<td style="text-align:left;">
Índice de concentración de mercado de las tres empresas más grandes por municipio y sector de actividad económica (SCIAN dos dígitos). Este indicador viene en términos porcentuales desde la fuente de datos original. La medida del indicador se guarda como: “promedio_ct3”, lo refiere al promedio de los tres principales centros de trabajo de los niveles ya mencionados.
</td>
</tr>
</tbody>
</table>
</div>
<div id="inputcenso" class="section level5 unnumbered hasAnchor">
<h5>Entradas - Inputs<a href="a-tibble-32-11.html#inputcenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Para la construcción de los indicadores es necesaria la Tabla 1, Incisos C, D, E, Censos Económicos 2019, datos de 2018, con el nombre “TABLA_1_INCISOS_CDE_C1C3C5_CE2019.xlsx”, específicamente la pestaña “C3”. El formato de la tabla no permite ser leído correctamente por el programa Rstudio, por lo que se creó una nueva tabla en formato .csv recuperando algunos de los campos de la tabla original.</p>
<p>Esta nueva tabla fue nombrada “TABLA_C3_CENSO2019.csv”, cuenta con 30 campos y 31,399 observaciones, cada una de las cuales corresponde a los datos de las tres empresas más grandes por municipio y actividad económica. A continuación, se muestra el detalle de la construcción de este insumo a partir de los documentos originales:</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:600px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-17">Tabla 5.2: </span>Campos que se utilizan para el cálculo de indicadores con base en el Censo Económico
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Información 
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Documento original 
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Nombre del campo en la nueva tabla 
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Clave (Entidad)  
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna A 
</td>
<td style="text-align:left;">
entidad 
</td>
</tr>
<tr>
<td style="text-align:left;">
Denominación (Entidad) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna B 
</td>
<td style="text-align:left;">
etiq_entidad 
</td>
</tr>
<tr>
<td style="text-align:left;">
Clave (Municipio)  
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna C 
</td>
<td style="text-align:left;">
municipio 
</td>
</tr>
<tr>
<td style="text-align:left;">
Denominación (Municipio) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna D 
</td>
<td style="text-align:left;">
etiq_municipio 
</td>
</tr>
<tr>
<td style="text-align:left;">
Código (Sector actividad) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna E 
</td>
<td style="text-align:left;">
scian2dgts 
</td>
</tr>
<tr>
<td style="text-align:left;">
Denominación (Sector actividad) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna F 
</td>
<td style="text-align:left;">
etiq_scian2dgts 
</td>
</tr>
<tr>
<td style="text-align:left;">
Total (C3 Índice de concentración del personal ocupado) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna G 
</td>
<td style="text-align:left;">
ct3_po 
</td>
</tr>
<tr>
<td style="text-align:left;">
Remunerado (C3 Índice de concentración del personal ocupado) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna H 
</td>
<td style="text-align:left;">
ct3_remunerado 
</td>
</tr>
<tr>
<td style="text-align:left;">
Contratado y proporcionado por otra razón social (C3 Índice de concentración del personal ocupado) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna I 
</td>
<td style="text-align:left;">
ct3_otra_razon 
</td>
</tr>
<tr>
<td style="text-align:left;">
En establecimientos informales (C3 Índice de concentración del personal ocupado) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna J 
</td>
<td style="text-align:left;">
ct3_ est_informales 
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal ocupado total (Remuneraciones Medias (Promedio anual)) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna K 
</td>
<td style="text-align:left;">
ct3_remun_po 
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal remunerado (Remuneraciones Medias (Promedio anual)) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna L 
</td>
<td style="text-align:left;">
ct3_remun_remunerado 
</td>
</tr>
<tr>
<td style="text-align:left;">
En establecimientos informales (Remuneraciones Medias (Promedio anual)) 
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna M 
</td>
<td style="text-align:left;">
ct3_remuin_est_informales 
</td>
</tr>
<tr>
<td style="text-align:left;">
Costo promedio del personal contratado y proporcionado por otra razón social  
</td>
<td style="text-align:left;">
Del documento: TABLA_1_INCISOS_CDE_C1C3C5_CE2019, pestaña: C3; columna N 
</td>
<td style="text-align:left;">
ct3_costo_otra_razon 
</td>
</tr>
<tr>
<td style="text-align:left;">
Unidades económicas 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna G 
</td>
<td style="text-align:left;">
ue 
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal Ocupado. Total.  Número de personas 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna H 
</td>
<td style="text-align:left;">
total_ocupado 
</td>
</tr>
<tr>
<td style="text-align:left;">
Total de personal dependiente de la razón social. Número de personas 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna i 
</td>
<td style="text-align:left;">
total_depndiente_rs 
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal remunerado. Total. Número de personas 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna J 
</td>
<td style="text-align:left;">
total_remunerado 
</td>
</tr>
<tr>
<td style="text-align:left;">
Personal que trabajó en este establecimiento contratado y proporcionado por otra razón social. Total. Número de personas 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna U 
</td>
<td style="text-align:left;">
total_otra_rs 
</td>
</tr>
<tr>
<td style="text-align:left;">
Pagos a otra razón social que contrató y le proporcionó personal a este establecimiento.  Millones de pesos 
</td>
<td style="text-align:left;">
Del documento: Tabla_2_incisos_A_B_C_CONFI 2019, pestaña: CE 2019 SIN ACUMULADOS, columna V 
</td>
<td style="text-align:left;">
total_costo_otra_rs 
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="aplicacioncenso" class="section level5 unnumbered hasAnchor">
<h5>Aplicación de scripts<a href="a-tibble-32-11.html#aplicacioncenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El cálculo de los indicadores del censo solo requiere un script “1_secuenciador_CENSO_v.R”. Este script carga la tabla de datos transformada como único insumo.</p>
<p>El script también realiza una limpieza de la tabla de datos quitando las observaciones que tienen el número de trabajadores como NA. Desde la base original, en la columna H que muestra el total de personas ocupadas, se encuentran 9,089 registros que tienen información faltante o NA. El rango de unidades económicas con NA va de 1 a 29, por lo que se prevé que hace parte de la censura estadística. Esta variable es importante ya que servirá para estimar el tamaño de las unidades económicas para producir el campo “cat_tamanio”, uno de los niveles de la agregación. Producto de esta limpieza resulta una tabla con 22,310 observaciones.</p>
<p>Posteriormente, las variables de acuerdo con la sintaxis utilizada en el SIDIL y crea dos variables auxiliares necesarias para el cálculo de los indicadores en el nivel de agregación, estas son:</p>
<ul>
<li><em>num_trabajadores</em>: El promedio de trabajadores de las tres empresas</li>
</ul>
<p><span class="math inline">\(\frac{\left( \frac{ct3_{po} \times totalocupados}{100} \right)}{3}\)</span></p>
<ul>
<li><em>cat_tamanio</em>: Categorización del número de trabajadores en las seis categorías que emplea el SIDIL.</li>
</ul>
<p>Finalmente se generan los indicadores subcontratación y concentración de mercado tomando las variables que vienen de la fuente de información original en términos porcentuales. Para homologar los indicadores a la escala de 0 a 1 de otros indicadores generados en el SIDIL, se divide la variable original entre 100.</p>
<p>La siguiente tabla muestra el detalle de este script:</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-18">Tabla 5.3: </span>Procesos para la actualización de indicadores con base en el censo económico
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Ejecución del usuario
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Ejecución automatizada
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Output
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Mensajes confirmatorios esperados
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Posibles mensajes de error
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Script secuenciador: 1_secuenciador_CENSO2019_v.R
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Dos archivos .Rds (uno por cada indicador):
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha cargado con éxito el insumo TABLA_C3_CENSO2019.csv”
</td>
<td style="text-align:left;">
“Hora sistema. <strong><em>ERROR</em></strong> No fue posible cargar el insumo TABLA_C3_CENSO2019.csv. Detalle”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 1_secuenciador_CENSO2019_v.R
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
censo_2019_concentra_aaaa_mm_dd_mmss.Rds
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha guardado el indicador subcontratación.”
</td>
<td style="text-align:left;">
“ Hora sistema. <strong><em>ERROR</em></strong> No fue posible guardar el indicador Subcontratación. Detalle”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 1_secuenciador_CENSO2019_v.R
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
censo_2019_subcontrat_aaaa_mm_dd_mmss.Rds
</td>
<td style="text-align:left;">
“ Hora sistema. INFO: Se ha guardado el indicador concentración de mercado”
</td>
<td style="text-align:left;">
“ Hora sistema. <strong><em>ERROR</em></strong> No fue posible guardar el indicador concentración de mercado. Detalle”
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="problemascenso" class="section level5 unnumbered hasAnchor">
<h5>Posibles problemas específicos en la aplicación de scripts<a href="a-tibble-32-11.html#problemascenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El principal problema que puede surgir para la generación de los indicadores del Censo Económico es que no se cuenta con la tabla transformada que sirve de insumo principal para el cálculo correspondiente. Como se mencionó en secciones anteriores, si se desean actualizar los indicadores con una versión posterior al Censo Económico 2019 se debe crear esta misma tabla con un insumo igual al proporcionado por el INEGI a la STPS.</p>
</div>
<div id="outputcenso" class="section level5 unnumbered hasAnchor">
<h5>Salidas - Outputs productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputcenso" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Todos los outputs del cálculo coyuntural de los indicadores laborales a partir de las fuentes de información mencionadas hasta aquí, guarda prácticamente la misma estructura de información. La única gran diferencia es el campo <em>n_registro</em> que aplica únicamente para el caso del IMSS.</p>
<p>Para cada combinación posible de indicador, periodo de información y fuente de información se genera una sola tabla con el output. Estas tablas se almacenan por separado, e incluyen siempre las dos alusiones temporales: i) el periodo de referencia, y ii) la fecha de cálculo (v). Los outputs se almacenan en formato <em>.Rds</em>. Estos outputs tienen, por lo general los campos que se muestran en la siguiente tabla.</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:600px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-19">Tabla 5.4: </span>Campos comunes en los resultados coyunturales del cálculo de indicadores
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Campo
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Descripción
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Clase
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
valor
</td>
<td style="text-align:left;">
Valor de la estimación puntual
</td>
<td style="text-align:left;">
Numérico
</td>
</tr>
<tr>
<td style="text-align:left;">
cv
</td>
<td style="text-align:left;">
Coeficiente de variación de la estimación puntual
</td>
<td style="text-align:left;">
Numérico
</td>
</tr>
<tr>
<td style="text-align:left;">
n_registro (únicamente aplica a los indicadores del IMSS)
</td>
<td style="text-align:left;">
Número de registros patronales distintos implicados en la estimación puntual
</td>
<td style="text-align:left;">
Entero
</td>
</tr>
<tr>
<td style="text-align:left;">
n_trabajadores
</td>
<td style="text-align:left;">
Número de trabajadores implicados en la estimación puntual
</td>
<td style="text-align:left;">
Numérico
</td>
</tr>
<tr>
<td style="text-align:left;">
anio
</td>
<td style="text-align:left;">
Año del periodo de referencia
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
mes
</td>
<td style="text-align:left;">
Mes del periodo de referencia (sólo en IMSS)
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
periodo
</td>
<td style="text-align:left;">
Periodo de referencia
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
Indicador
</td>
<td style="text-align:left;">
Código del indicador
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
script_calculo
</td>
<td style="text-align:left;">
Script que dio origen al cálculo del indicador
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
fecha_calculo
</td>
<td style="text-align:left;">
Fecha de calculo
</td>
<td style="text-align:left;">
Fecha
</td>
</tr>
<tr>
<td style="text-align:left;">
usuario
</td>
<td style="text-align:left;">
Usuario que realizó el cálculo
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
cat_tamanio
</td>
<td style="text-align:left;">
Categoría de tamaño
</td>
<td style="text-align:left;">
Numérica
</td>
</tr>
<tr>
<td style="text-align:left;">
geo2
</td>
<td style="text-align:left;">
Entidad federativa
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
geo5
</td>
<td style="text-align:left;">
Municipio
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
scian2018_2
</td>
<td style="text-align:left;">
Clasificación industrial a 2 dígitos del SCIAN 2018
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
scian2018_3
</td>
<td style="text-align:left;">
Clasificación industrial a 3 dígitos del SCIAN 2018
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
agregacion
</td>
<td style="text-align:left;">
Código no numérico del nivel de agregación
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
agregacion_numerica
</td>
<td style="text-align:left;">
Código numérico del nivel de agregación
</td>
<td style="text-align:left;">
Numérico
</td>
</tr>
<tr>
<td style="text-align:left;">
grupo_calidad_info2
</td>
<td style="text-align:left;">
Grupo de calidad de información a 2 dígitos
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
<tr>
<td style="text-align:left;">
grupo_calidad_info1
</td>
<td style="text-align:left;">
Grupo de calidad de información a 1 dígito
</td>
<td style="text-align:left;">
Carácter
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="procesamientoModIcoyvshist" class="section level3 hasAnchor" number="5.0.1">
<h3><span class="header-section-number">5.0.1</span> Estimaciones puntuales e históricas de indicadores<a href="a-tibble-32-11.html#procesamientoModIcoyvshist" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El resultado de realizar las estimaciones puntuales de los diversos indicadores a partir de las diferentes fuentes de información es en realidad un <em>conjunto de tablas</em> que se almacenan en la carpeta <em>3_resultados/coyuntura/…</em> en las respectivas subcarpetas de cada fuente de información e indicador correspondiente.</p>
<p>Sin embargo, sólo a modo ilustrativo, la tabla a continuación presenta de manera sintética y sobre-simplificada cómo sería si todas estas estimaciones puntuales de la coyuntura fueran reunidas en una sola tabla<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. Reunir todas estas estimaciones se traduce en cientos de miles de filas para el periodo de referencia más reciente solamente.</p>
<p>Antes de profundizar en el objeto de esta sección, conviene aprovechar este ejemplo para enfatizar:</p>
<p>– <strong>Que</strong> <strong>las fuentes de información no necesariamente coincidirán exactamente en el mismo periodo de referencia</strong>: En el ejemplo a continuación se plantea el hipotético caso en el que los datos del IMSS permiten tener un periodo de referencia para abril 2022 mientras que los datos de la ENOE, por su naturaleza trimestral, cubren el primer trimestre del mismo año. Esto no es un problema toda vez que el <em>matching</em> coyuntural incorpora el último periodo de referencia disponible de cada indicador. Así, el caso extremo es el de los indicadores del Censo Económico, mismos que se seguirán imputando como los más recientes y a la par de los indicadores más recientes del IMSS y de la ENOE, hasta que en 2024 o 2025 surja una versión más reciente del censo.</p>
<p>– <strong>Que</strong> <strong>cuando el nivel de agregación no especifica cierta dimensión (por ejemplo, la clasificación industrial en la primera observación del ejemplo), los valores de las columnas excluidas estarán en NA</strong>. En cambio, si al interior de las dimensiones geografía y clasificación industrial se estipula el mayor nivel de desagregación posible (municipio o SCIAN a 3 dígitos) entonces, si bien la etiqueta de dicho nivel no lo hace explícito, la categoría “superior” (entidad o SCIAN a 2 dígitos) también es incluida<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
<p><strong>- Que los valores de los indicadores <em>luego</em> de ser imputados a los CT (módulo II o IV) no son re-expresados (estandarizados) a valores entre 0 y 1 toda vez que dicho procedimiento se realiza sobre el universo de CT con sus respectivos indicadores imputados</strong> <mark>Ver recuadro XXXX_4_XXX</mark>. Dicha estandarización es, además, realizada por indicador. Sin embargo el módulo I sí concluye expresando a todos los indicadores con el mismo sentido ordinal, es decir, que “más es mejor”. Los coeficientes de variación ya se expresan en términos porcentuales.</p>
<p>- <strong>Que la explotación de este tipo de tablas requiere de la cautela de que la misma unidad de observación se representa en diferentes niveles de agregación. Esto es importante a efectos de la explotación rápida de indicadores precalculados</strong>. Es decir, que en la interpretación y explotación de esta información se debe evitar caer en la paradoja de Simpson, paradoja en la cual una tendencia que aparece en diferentes grupos de datos se invierte o desaparece cuando se combinan los grupos. De la misma manera, una explotación inadecuada puede arrojar categorías de columnas incompletas. Por ejemplo, si no se filtrara la información por “1_geo2” (entidades) entonces dicha columna tendrá observaciones vacías.</p>
<p>- <strong>Que para el cálculo de estas estimaciones no se toma en consideración las necesidades de información para el match con el universo de CT. Es decir, en la explotación de las fuentes de información, se aplican los algoritmos para todas las posibles combinaciones de categorías dentro de los diversos niveles de agregación</strong>. Si bien la persona usuaria podría acotar estas estimaciones por su significancia estadística (ajustando los valores umbrales en el catálogo de indicadores), no hay, al menos por diseño, una evaluación ex ante si realmente es necesaria la estimación en todas las categorías especificadas. Esto, fundamentalmente, porque por su propia naturaleza siempre es posible que al DNE se incorpore un nuevo CT con una determinada combinación de categorías de geografía, clasificación industrial y tamaño que no se presentaba hasta entonces en el DNE y que ahora se necesite dicha estimación puntual. Además, es deseable la combinatoria de categorías toda vez que si el usuario restringe el nivel de significancia estadística entonces las estimaciones de menor nivel de agregación (usualmente de mayor significancia) se volverán más relevantes. De no hacerlo así como está configurado, entonces si surgiera ese nuevo CT con combinación de categorías previamente inexistentes, entonces habría que volver a realizar todas las estimaciones del módulo I.</p>
<p>- <strong>“Oferta” de estimaciones: este acervo de estimaciones coyunturales sería suficiente para ofrecer de manera sistematizada reportes que caractericen al mercado laboral con diferentes niveles de especificación</strong>. Es decir, dada la estructura estable de esta información, independientemente de la posible heterogeneidad del periodo de referencia, cabe pensar que a partir de estas diferentes tablas (aquí sólo reunidas a fines ilustrativos) podrían incorporarse rutinas que permitan dar un seguimiento más o menos pormenorizado de ciertos fenómenos laborales a diferentes niveles de agregación. Así, como fue visto durante las sesiones de acompañamiento, esto constituye la oferta de estimaciones puntuales para los diferentes indicadores.</p>
<p>-<strong>Recordar que las estimaciones puntuales del IMSS se basan en la observación en un centro de trabajo, y luego se agrega por centros de trabajo</strong> que compongan las diferentes categorías de los niveles de agregación, motivo por el cual no necesariamente coincidirán con estimaciones realizadas por trabajador.</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:600px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-20">Tabla 5.5: </span>Presentación esquematizada de los indicadores coyunturales en sus diferentes niveles de agregación
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Fuente
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Agregación
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Indicador
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Periodo
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Valor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
CV
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
SCIAN2
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
SCIAN3
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Entidad
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Municipio
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Categoría Tamaño
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
2_entidad_tamaño
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
44.50
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_scian2
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
41.06
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_tamanio
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
12.93
</td>
<td style="text-align:right;">
57.66
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
3_municipio_scian3_tamaño
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
23.62
</td>
<td style="text-align:right;">
14.64
</td>
<td style="text-align:left;">
54
</td>
<td style="text-align:left;">
541
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
23012
</td>
<td style="text-align:left;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
3_entidad_scian2_tamaño
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
1.64
</td>
<td style="text-align:right;">
55.08
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_scian3
</td>
<td style="text-align:left;">
Rotación laboral
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
46.16
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
111
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_entidad
</td>
<td style="text-align:left;">
Prevalencia s.m.
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
81.78
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_municipio
</td>
<td style="text-align:left;">
Prevalencia s.m.
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
84.89
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
31
</td>
<td style="text-align:left;">
31054
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
2_scian2_tamaño
</td>
<td style="text-align:left;">
Brecha de género (IMSS)
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;">
7.78
</td>
<td style="text-align:left;">
43
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
3_municipio_scian3_tamaño
</td>
<td style="text-align:left;">
Brecha de género (IMSS)
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
98.84
</td>
<td style="text-align:left;">
49
</td>
<td style="text-align:left;">
491
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
3001
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
3_entidad_scian2_tamaño
</td>
<td style="text-align:left;">
Brecha de género (IMSS)
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
71.17
</td>
<td style="text-align:left;">
61
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
8047
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
IMSS
</td>
<td style="text-align:left;">
1_scian3
</td>
<td style="text-align:left;">
Tasa de accidentes por asegurado
</td>
<td style="text-align:left;">
202204
</td>
<td style="text-align:right;">
0.98
</td>
<td style="text-align:right;">
68.14
</td>
<td style="text-align:left;">
61
</td>
<td style="text-align:left;">
613
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
1_scian3
</td>
<td style="text-align:left;">
Tasa de sindicalización
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
94.66
</td>
<td style="text-align:left;">
31
</td>
<td style="text-align:left;">
313
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
1_entidad
</td>
<td style="text-align:left;">
Acceso a prestacc. Soc.
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
19.17
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
25
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
1_municipio
</td>
<td style="text-align:left;">
Acceso a prestacc. Soc.
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
71.16
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
24
</td>
<td style="text-align:left;">
24012
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
1_scian2
</td>
<td style="text-align:left;">
Acceso a seguridad social
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:right;">
13.83
</td>
<td style="text-align:left;">
93
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
3_entidad_scian2_tamaño
</td>
<td style="text-align:left;">
Acceso a seguridad social
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
32.29
</td>
<td style="text-align:left;">
83
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
27
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
2_entidad_tamaño
</td>
<td style="text-align:left;">
Acceso a contrato escrito
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
76.45
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
1_entidad
</td>
<td style="text-align:left;">
Horas trabajadas
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
31.40
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ENOE
</td>
<td style="text-align:left;">
2_scian2_tamaño
</td>
<td style="text-align:left;">
Ingreso laboral por hora
</td>
<td style="text-align:left;">
1T2023
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
17.09
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
5
</td>
</tr>
</tbody>
</table>
</div>
<p><strong>A partir del análisis de las tablas resultado de los indicadores coyunturales de cada indicador, se pone en evidencia la facilidad con la que podría construirse un compendio histórico de indicadores</strong>. Esto, en realidad, forma parte del módulo IV; pero conviene presentarlo aquí por completitud. Si a la tabla anterior uno la extendiera en el tiempo para incorporar todas las estimaciones realizadas a lo largo de todos los periodos de referencia previos al último, obtendría un resultado como el de la Ilustración 5 – a continuación – es decir, el compendio de indicadores calculados de manera consistente a lo largo del tiempo para las diferentes posibles combinaciones de categorías en los diversos niveles de agregación.</p>
<p><strong>Esto es lo que constituye, ahora sí, la oferta “histórica” de indicadores laborales calculados.</strong> Esto, insistimos, es el histórico de indicadores calculados de manera consistente a partir del SIDIL y permite a un costo muy bajo, acceder a su serie histórica para caracterizar la evolución de ciertos fenómenos laborales.</p>
<p>Observando que sigue siendo una simplificación ilustrativa<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>, en el recuadro rojo se presenta lo que podría ser el cálculo coyuntural (módulo I) al 10 de mayo de 2023, cuando teóricamente la DGIET ya accede a los microdatos del IMSS y aun no se publica el primer trimestre de 2023 de la ENOE. En cambio, el resto de los periodos temporales (resaltados en color de fuente roja, fuera del recuadro rojo) es la representación simplificada de los mismos indicadores para periodos de referencia previos. Se hace notar, adicionalmente a los puntos anteriores, que:</p>
<ul>
<li><p><strong>Se reúnen todos los elementos para una rápida representación gráfica y/o geográfica de los fenómenos laborales medidos por SIDIL</strong>. Observando que la construcción de este tipo de tablas no sólo es relativamente sencilla (aunque excede el alcance y necesidades del SIDIL) pero que permite la explotación de información con diferentes propósitos:</p>
<ul>
<li><p>Si sólo se tratase del recuadro rojo – indicadores coyunturales- entonces permite un corte transversal en diferentes niveles de profundización (los niveles de agregación), representando la heterogeneidad en las estimaciones y su respectiva significancia estadística.</p></li>
<li><p>Si se tratase de toda la tabla, se permite un corte longitudinal: un análisis de la evolución temporal de un indicador (o un conjunto de ellos) en los diferentes niveles de agregación, a lo largo de todos los periodos disponibles.</p></li>
</ul></li>
</ul>
<div class="figure"><span style="display:block;" id="fig:tabla1"></span>
<img src="images-1/04/tabla1.png" alt="Presentación esquematizada del resultado del cálculo de indicadores de manera histórica." width="80%" />
<p class="caption">
Recuadro 5.1: Presentación esquematizada del resultado del cálculo de indicadores de manera histórica.
</p>
</div>
<p>Nota: * El recuadro rojo representa el resultado del módulo I.</p>
</div>
<div id="moduloii" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Módulo II: imputación de indicadores y generación de la MPR<a href="a-tibble-32-11.html#moduloii" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="propositomoduloii" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Propósito principal<a href="a-tibble-32-11.html#propositomoduloii" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Este módulo tiene como propósito principal generar la Matriz de Predicción de Riesgo (MPR), la cual contiene, entre otra información, las predicciones de riesgo en determinadas submaterias para cada uno de los centros de trabajo del DNE. Para dicho objetivo general, se procuran tres objetivos específicos:</p>
<ol style="list-style-type: decimal">
<li><p>Consultar el universo de CT susceptibles de ser inspeccionados, junto con sus atributos</p></li>
<li><p>Caracterizarlos con los indicadores laborales calculados en el módulo I</p></li>
<li><p>Realizar una predicción de riesgo con base en el modelo predictivo preentrenado.</p></li>
</ol>
<p>Así, en este módulo se presenta, primero, el mecanismo de acceso al DNE para obtener el listado de los CT con sus principales atributos. Ahí mismo se presenta el mecanismo de enriquecimiento de los atributos más importantes (<em>geo2, geo5, scian2018_2, scian2018_3</em> y <em>cat_tamanio</em>) por correspondencia nominativa con el registro patronal en el IMSS. Le sigue el script de matching o imputación de los indicadores calculados de manera coyuntural a cada uno de los centros de trabajo del DNE y posteriormente, la aplicación o deploy del modelo entrenado que, con base en el historial de inspecciones explotado en el módulo IV, y las características atribuidas a los CT de manera coyuntural, predice un riesgo de incumplimiento por submateria de inspección.</p>
</div>
<div id="requisitosmoduloii" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Requisitos para la ejecución de este módulo<a href="a-tibble-32-11.html#requisitosmoduloii" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para la ejecución de este módulo es necesario contar con <em>R Studio</em> y <em>Python</em>. Los scripts en Python pueden ser ejecutados desde <em>R Studio* con apoyo de la paquetería</em> reticulate* o directamente desde la terminal o cmd de cualquier computadora.</p>
<p>Este módulo requiere de un acceso al DNE y potencialmente al historial de inspecciones en SIAPI y SIPAS. Sin embargo, conforme dichos sistemas están en rediseño, se han realizado consultas a la última versión disponible, respectivamente, y almacenado a disco. Esto permite leer esta información como si fuera un insumo adicional, aunque también se incluyen los scripts de conexión y query a dichos sistemas.</p>
<div id="procesamientoModuloIIConsultaDNE" class="section level4 hasAnchor" number="5.1.2.1">
<h4><span class="header-section-number">5.1.2.1</span> Consulta al DNE<a href="a-tibble-32-11.html#procesamientoModuloIIConsultaDNE" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El propósito de esta primera parte es acceder al universo de CT más reciente, así como está registrado en tablas específicas del DNE, particularmente las tablas <em>centro_trabajo</em>, <em>empresa</em> y <em>grupo_empresa</em>. Cabe destacar que en la consulta de los CT:</p>
<ul>
<li><p>Se acceden a atributos tales como la clasificación industrial en el SCIAN o la rama industrial del CT, la presencia ciertas características asociadas a mayores riesgos en materia de seguridad e higiene (por ejemplo, la presencia de materiales pirofóricos, sustancias químicas peligrosas, etc)</p></li>
<li><p>La selección exacta de los campos que se consultan debe especificarse en el catálogo de campos del DNE.</p></li>
<li><p>Los CT que se consultan constituyen todo el universo de CT susceptible de ser inspeccionados, sin importar si tienen antecedentes de inspección o no.</p></li>
</ul>
<div id="inputdne" class="section level5 unnumbered hasAnchor">
<h5>Entradas - Inputs<a href="a-tibble-32-11.html#inputdne" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El principal input es el catálogo de campos del DNE, mismo que permite a un usuario especificar cuáles campos se consultan del Directorio Nacional de Empresas. Al respecto, ver la sección 3.9. A esto cabe agregarle que se incorpora la última base de patrones registrados ante el IMSS; conforme lo realiza el secuenciador del IMSS.</p>
</div>
<div id="aplicaciondne" class="section level5 unnumbered hasAnchor">
<h5>Aplicación de scripts<a href="a-tibble-32-11.html#aplicaciondne" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Para actualizar el universo de CT que están disponibles en el DNE, independientemente de su historial de inspecciones, se realizan los siguientes procedimientos.</p>
<ul>
<li><p><em>Script consulta (1script):* Este script es un secuenciador que inicia con la ejecución del script de configuración inicial (ver sección 3.3.1) y además define el valor del parámetro</em> sinkmode <em>: si es igual a TRUE (verdadero) genera y guarda el log en un archivo “.txt”; mientras que si es FALSE (falso) no se registrará un log. Para el funcionamiento habitual del script el parámetro se entrega como *sinkmode=TRUE.* Este script luego detecta automáticamente la última versión del script</em> extractor.*</p></li>
<li><p><em>Script de extracción (1 script):</em> Este script tiene dos pasos fundamentales. Primero establece la conexión al SQL ejecutando otro script llamado <em>conexión.R</em>, luego detecta los campos del catálogo de campos del DNE que se procuran extraer del sistema SQL y para cada una de las entidades de dicho sistema, define, envía y recolecta una <em>query</em> al SQL. El resultado de esto son tantos dataframes almacenados en la RAM como entidades en la base SQL se hayan definido en el catálogo de campos. Por último, este script construye un dataframe <em>DNE_inicial</em> que resulta de la combinación de dichas entidades. El resultado de dicha construcción es almacenado a disco, en la carpeta <em>1_insumos/originales/orig_DNE</em> como <em>DNE_inicial_v.Rds</em>.</p></li>
<li><p>El script de consulta identifica la versión de DNE_inicial más reciente (lo define como un parámetro llamado <em>ultimo_DNE_orig</em> mismo que lee a la RAM para la posterior refinación de ciertos campos. En concreto se definen las clases de los campos y se depura información sobre la entidad federativa y el municipios, para conformar una base de los CT con la variable geográfica “limpia”. Luego se le asocia la información de los catálogos de actividades del SCIAN y rama industrial y se limpia la variaba <em>ct_imss_registro</em> que permite el match de enriquecimiento y nominativo con los registros del IMSS. También aquí se realiza el primero de estos matches, utilizando como insumo el último de los <em>procesados</em> bajo en la carpeta <em>1_insumos/procesados/coy_IMSS_pat</em>. El propósito es tener los CT del DNE enriquecidos con la última información disponible de los patrones en el IMSS, en particular, en cuanto al tamaño del CT. El resultado de este procedimiento es la tabla llamada <em>DNE_plus_v.Rds</em></p></li>
</ul>
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;border-bottom: 0;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-21">Tabla 5.6: </span>Procesos para la actualización del universo de CT con base en el DNE
</caption>
<thead>
<tr>
<th style="text-align:left;">
Ejecución del usuario
</th>
<th style="text-align:left;">
Ejecución automatizada
</th>
<th style="text-align:left;">
Output
</th>
<th style="text-align:left;">
Principales mensajes confirmatorios esperados[1]
</th>
<th style="text-align:left;">
Posibles mensajes de error o advertencia
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Script secuenciador: 2_consulta_DNE
</td>
<td style="text-align:left;">
Script de configuración inicial: 0_config_inicial
</td>
<td style="text-align:left;">
Definición de parámetros y funciones, carga de catálogos
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha ejecutado con éxito el script 0_config_inicial.R”
</td>
<td style="text-align:left;">
“Hora sistema. <strong><em>ERROR</em></strong> No fue posible ejecutar el script 0_config_inicial.R. Detalle:”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 2_consulta_DNE
</td>
<td style="text-align:left;">
Script de configuración inicial: 0_config_inicial
</td>
<td style="text-align:left;">
Definición de log de extracción de DNE:
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha ejecutado con éxito el script 0_config_inicial.R”
</td>
<td style="text-align:left;">
“Hora sistema. <strong><em>ERROR</em></strong> No fue posible iniciar la escritura del log de consulta al DNE. Detalle”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 2_consulta_DNE
</td>
<td style="text-align:left;">
Script de extracción y transformación: 1_extraccion_DNE
</td>
<td style="text-align:left;">
DNE_inicialRds
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha exportado la consulta inicial del DNE a DNE_inicial_v.Rds
</td>
<td style="text-align:left;">
“Hora sistema. <strong><em>ERROR</em></strong> No fue posible ejecutar el script 1_B_1_S_EST_IMSS_v. Detalle:”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 2_consulta_DNE
</td>
<td style="text-align:left;">
Script de extracción y transformación: 1_extraccion_DNE
</td>
<td style="text-align:left;">
DNE_inicialRds
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Se ha exportado la consulta inicial del DNE a DNE_inicial_v.Rds
</td>
<td style="text-align:left;">
“Hora sistema <strong><em>ADVERTENCIA</em></strong> Se introdujeron NAs: simpleWarning in FUN(X[[i]], …): NAs introduced by coerción”
</td>
</tr>
<tr>
<td style="text-align:left;">
Script secuenciador: 2_consulta_DNE
</td>
<td style="text-align:left;">
Limpieza, unión con catálogos y enriquecimiento con base en patrones registrados ante el IMSS
</td>
<td style="text-align:left;">
DNE_plus.Rds mismo que incluye el match de enriquecimiento.
</td>
<td style="text-align:left;">
“Hora sistema. INFO: Consulta al DNE actualizada al [fecha v]. Ultimo CT incorporado tiene fecha de alta [fecha]. Hay”XX” CT en esta ultima consulta.
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>1</sup> Estos mensajes se muestran en la consola del RStudio al momento de ejecutar el script secuenciador y quedan registrados en la bitácora al momento de finalizar su ejecución.
</td>
</tr>
</tfoot>
</table>
</div>
<div id="problemasdne" class="section level5 unnumbered hasAnchor">
<h5>Posibles problemas específicos en la aplicación de scripts<a href="a-tibble-32-11.html#problemasdne" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>Hay dos principales problemas que podrían ocurrir</strong><mark>. Primero, que no se pueda acceder al universo de CT registrados en el DNE. Esto dependerá del mecanismo de conexión a dicha base.</mark> Segundo, que no se pueda acceder a la base de registros patronales obtenida del IMSS, mismo que impediría la imputación o match de enriquecimiento. El primer problema deriva en que no se incluirían en la MPR aquellos CT de más reciente incorporación, esto es, los CT de reciente incorporación no serían incluidos en la estrategia de priorización (módulo III). El segundo problema, si bien a junio 2023 abona el enriquecimiento de información sobre la categoría de tamaño de aproximadamente 170 mil CT, afectaría la calidad de la imputación por nivel de agregación (al no haber enriquecido la variable <em>cat_tamanio</em>).</p>
</div>
<div id="frecuenciadne" class="section level5 unnumbered hasAnchor">
<h5>Frecuencia de actualización y propuesta de calendarización<a href="a-tibble-32-11.html#frecuenciadne" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Se propone que la consulta al universo de CT registrado en el DNE se realice cuando menos cada tres meses, cada vez que se actualiza la ENOE. No sobra decir que, de haber modificaciones sustantivas en el DNE, estas podrían ameritar anticipar dicha consulta para poder reflejar dichos cambios en el universo de CT en la MPR.</p>
</div>
</div>
</div>
<div id="procesamientoModIIimputacion" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Imputación de indicadores laborales al universo de CT<a href="a-tibble-32-11.html#procesamientoModIIimputacion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Este módulo tiene el propósito de explicar el proceso de imputación de los indicadores calculados al universo de centros de trabajo. El objetivo principal de esta imputación o “matching” es que cada uno de los centros de trabajo del DNE cuente con un valor de cada uno de los indicadores, sin importar si se tiene poca o mucha información de dicho centro de trabajo.</p>
<p><strong>El matching se realiza de dos maneras dependiendo de la información que se tenga disponible</strong> de cada CT y del alcance de la fuente de información original de los indicadores. Estas son: matching nominativo y por nivel de agregación.</p>
<p><strong>Notar que el matching que ocurre en el módulo II es únicamente sobre el universo de indicadores coyunturales</strong>, es decir, aquellos resultados del módulo I, o dicho de otra forma, la última estimación puntual disponible para cada indicador de cada fuente de información. Por eso es que esto también se conoce como <em>matching coyuntural.</em></p>
<div id="matchnom" class="section level4 unnumbered hasAnchor">
<h4>Matching nominativo<a href="a-tibble-32-11.html#matchnom" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El matching nominativo es el proceso de imputar los indicadores calculados de manera nominativa (a nivel registro patronal) del IMSS a cada uno de los CT del DNE</strong>. En otras palabras, el matching nominativo relaciona las tablas de datos del DNE y del IMSS para identificar a los centros de trabajo que se encuentran en ambas tablas y asignar los valores de los indicadores del IMSS calculados para cada centro de trabajo con información nominativa. Los CT se identifican en ambas tablas a través del número de registro del IMSS.</p>
</div>
<div id="matchnivel" class="section level4 unnumbered hasAnchor">
<h4>Matching por nivel de agregación<a href="a-tibble-32-11.html#matchnivel" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El matching por nivel de agregación imputa indicadores calculados por nivel de agregación a partir de las características observadas en cuanto a la ubicación geográfica (entidad federativa y municipio, clasificación industrial – SCIAN a 2 y 3 dígitos – y categoría de tamaño) de los CT en el DNE</strong>. De esta manera, se asigna un valor de cada uno de los indicadores de la ENOE, del Censo Económico y del IMSS (aquellos que no fueron relacionados en el matching nominaintetivo) a cada CT. Entre más información se tenga de las características del CT (ubicación geográfica, tamaño de la empresa y actividad económica), se imputará un valor del indicador calculado a un nivel de agregación mayor o más desagregado.</p>
</div>
<div id="scriptmatch" class="section level4 unnumbered hasAnchor">
<h4>Aplicación de script<a href="a-tibble-32-11.html#scriptmatch" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Los dos procesos descritos anteriormente se realizan en un solo script desarrollado en el lenguaje Python</strong>. El script <em>“2_matching_coyuntural_.py”</em> se encuentra en la carpeta <em>2_codigos/coyuntura/ cod_matching</em> correspondiente de códigos. Su aplicación o despliegue se puede llevar a cabo mediante Rstudio.</p>
<p>Al ejecutarlo, el script carga las paqueterías, establece las direcciones e importa los catálogos de indicadores y de niveles de agregación. Posteriormente, genera las funciones para: renombrar columnas, crea diccionario de insumos que se van a cargar, diccionario de rutas, crea diccionario para construcción de la variable llave (“key”), la cual genera un vector de campos dicotómico a partir de la existencia o no de la información en el campo, creando una matriz de 1 y 0 con las posibles combinaciones de la llave. Esta llave luego se concatena en un solo campo. Junto con estas, se generan diversas funciones útiles para el correcto funcionamiento del código (limpieza de campos, reemplazo de valores faltantes, etc).</p>
<p>Posteriormente, se cargan los insumos (que se detallan en la siguiente sección), se realiza la imputación de los indicadores del IMSS a los centros de trabajo que se encuentran tanto en IMSS como en DNE. Finalmente se realiza el matching por nivel de agregación de indicadores de ENOE, Censo y aquellos del IMSS que no fueron imputados de manera nominativa.</p>
</div>
<div id="inputmatch" class="section level4 unnumbered hasAnchor">
<h4>Entradas - Inputs<a href="a-tibble-32-11.html#inputmatch" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Este algoritmo requiere insumos o inputs que son el resultado (outputs) de los procesos realizados en el módulo anterior o previamente en este módulo. Estos son:</p>
<ul>
<li><p><strong>El resultado del paso anterior, es decir, el universo de CT consultado más recientemente del DNE, la cual contiene el universo de CT a los cuales se les imputarán las estimaciones puntuales de los indicadores.</strong> El nombre de este insumo es “DNE_PLUS_(v).Rds”, donde la (v) hace referencia al versionado. Notar que <em>DNE_plus</em> ya trae enriquecido el campo <em>cat_tamanio</em> para aquellos CT cuyo registro patronal coincide entre el DNE y el registro patronal del IMSS.</p></li>
<li><p><strong>Las tablas de indicadores del IMSS (calculados de manera nominativa y por nivel de agregación), ENOE y Censo</strong> Económico. El script de matching coyuntural recupera la versión más reciente de los indicadores calculados (según la <em>v</em> sufijo de cada tabla de indicadores). Dichos indicadores tienen la siguiente convención en el nombre: nombre de la base de datos en minúscula seguido del nombre del indicador, seguida del periodo de referencia (trimestre en la ENOE o trimestre móvil del IMSS) y el versionado (fecha y hora). El formato de estos archivos es <em>.Rds</em>. Por poner un ejemplo para el caso de la ENOE, “<em>enoe_dias_trab_2t_2022_11_03_0213</em>”. (Ver las subsecciones de 4.1.4: Detalle de ENOE, Detalle de IMSS, Detalle de Censo económico )</p></li>
</ul>
</div>
<div id="outputmatch" class="section level4 unnumbered hasAnchor">
<h4>Salidas - Outputs - Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputmatch" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El matching coyuntural es el último paso previo a la generación de la MPR.</strong> Se define el nombre de la tabla resultante de este proceso como el Universo de CT con indicadores, abreviado a <em>UniversoCTconIndicadores_v</em>.</p>
<p><strong>Comprender las dimensiones del producto de este proceso facilita la comprensión de la propia MPR. Hay dos factores que explican las dimensiones que toma el producto del matching coyuntural.</strong></p>
<p><strong>Por un lado, el número de observaciones que tendrá esta tabla será exactamente igual al número de centros de trabajo registrados en el DNE</strong>, <strong>siguiendo su identificador único, <em>centro_trabajo_id</em>.</strong> Es decir, si dos CT en el DNE tienen diferente <em>centro_trabajo_id</em> en el DNE, pero toda la demás información sobre ellos en el DNE es la misma, tanto la consulta al DNE (primer paso del módulo II) como el matching coyuntural, ignorarán este posible duplicado y dejarán el número total de CT intacto.</p>
<p><strong>Por otro lado, el producto del matching coyuntural contendrá tres tipos de columnas que dependen de ciertos factores para determinar la dimensión que tomen</strong>. Primero, el número de atributos que se consultan del DNE, y/o que se imputan a partir de cálculos del SIAPI/SIPAS. Esto está definido por el catálogo de campos que se consultan del DNE<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>. El segundo factor será el número de indicadores que se calculan, mismo que se puede observar en el catálogo de indicadores. El primer caso determinará el número de columnas <em>atributos</em>¸mientras que el segundo caso determinará el número de columnas <em>indicadores.</em> El tercer factor son los campos de identificación (actualmente <em>centro_trabajo_id</em> y <em>ct_imss_registro</em> - el número de registro patronal en el IMSS) que, si bien técnicamente están incluidos en el catálogo de campos del DNE, es más intuitivo mantenerlos por separado toda vez que el valor que éstos campos toman no tiene injerencia en el modelo predictivo, sino que son únicamente funcionales a la identificación del CT y a su posible <em>match</em> nominativo con el IMSS.</p>
<p><strong>Tanto las columnas de <em>atributos,</em> como las columnas de indicadores, aparecen en su respectivo catálogo, independientemente de cómo se caractericen dichas columnas en su catálogo.</strong> Al respecto, recordar que en el catálogo de campos del DNE hay dos campos que merecen la atención. Primero, el campo <em>entra_al_modelo.</em> Este campo es únicamente para definir si los respectivos campos del DNE y los indicadores son variables de entrada para el modelo (ver <a href="a-tibble-32-11.html#procesamientoModIV">Módulo IV</a>). Es decir, el valor que esta columna del catálogo de campos del DNE tome no afecta si los campos del DNE entren o no al universo matcheado. Segundo, el campo <em>tipo</em>, mismo que determina el tipo de filtro que le aplica a este campo una vez que se genera la MPR en el siguiente paso.</p>
<p><strong>Aquí es importante notar que ninguna de estas dos columnas del catálogo de campos del DNE tiene efectos sobre la inclusión de los campos del DNE</strong> que se incluyen el universo de CT matcheado con indicadores coyunturales.</p>
<p><strong>De la misma manera, la inclusión de las columnas <em>indicadores</em> de este producto que, como fue descrito, dependen del catálogo de indicadores, son independientes del campo <em>entra_al_modelo</em></strong><em>,</em> toda vez que ello sólo afecta su inclusión en el entrenamiento del mismo, y no en la inclusión de la MPR. Es decir, todos los indicadores mencionados en este catálogo buscarán ser incorporados en el matching coyuntural.</p>
<p><strong>Considerando lo anterior, a abril 2023, se encuentran 67 columnas en el producto del matching coyuntural, y aproximadamente 617 mil CT</strong>. Esta tabla será el insumo para realizar la predicción del riesgo para cada uno de los CT. El archivo se guarda con la siguiente estructura de nombre: <em>UniversoCTconIndicadores</em>_(v) y en resumen la tabla cuenta con campos de distinto tipo, y estos son:</p>
<ul>
<li><p>Identificación: Campos identificadores para cada centro de trabajo, también utilizados para identificar los centros de trabajo en común entre el DNE y el IMSS Patrones.</p></li>
<li><p>Atributos: Campos de atributos de los centros de trabajo, que vienen desde el DNE, o bien, fueron enriquecidas por el IMSS Patrones.</p></li>
<li><p>Indicadores: Campos de indicadores de la ENOE, IMSS y Censo Económico.</p></li>
</ul>
</div>
<div id="problemasmatch" class="section level4 unnumbered hasAnchor">
<h4>Posibles problemas específicos en la aplicación de scripts<a href="a-tibble-32-11.html#problemasmatch" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los principales problemas que pueden surgir al ejecutar el script son los relacionados con problemas en los insumos. De no encontrarse alguno de los insumos con los nombres estipulados en las secciones anteriores o con estructuras diferentes de las estipuladas en el presente documento, será imposible que el script se ejecute de manera correcta.</p>
</div>
<div id="mensajesmath" class="section level4 unnumbered hasAnchor">
<h4>Mensajes generados<a href="a-tibble-32-11.html#mensajesmath" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La ejecución del script mencionado en la subsección anterior puede detonar en alguno(s) de los siguientes mensajes:</p>
<p>Mensajes de error:</p>
<ul>
<li><p>***ERROR*** No se ha encontrado ningún archivo en el directorio</p></li>
<li><p>***ERROR*** No se ha generado el producto final</p></li>
</ul>
<p>Mensajes de confirmación:</p>
<ul>
<li><p>INFO: La fecha de hoy es …</p></li>
<li><p>INFO: El directorio de trabajo es…</p></li>
<li><p>INFO: Lista de insumos generada</p></li>
<li><p>INFO: Inicio de lectura de insumos</p></li>
<li><p>INFO: Lectura de insumos completada</p></li>
<li><p>INFO: Inicio del matching nominativo</p></li>
<li><p>INFO: Inicio matching por agregación</p></li>
<li><p>INFO: Fin del script de matching coyuntural. Tardó … segundos</p></li>
<li><p>INFO: Producto Final -&gt; UniversoCTconIndicadores_v.Rds</p></li>
</ul>
</div>
<div id="frecuenciamatch" class="section level4 unnumbered hasAnchor">
<h4>Frecuencia de actualización y propuesta de calendarización<a href="a-tibble-32-11.html#frecuenciamatch" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se sugiere que la frecuencia de actualización sea cada trimestre, posterior de la actualización de los indicadores y de la consulta al DNE.</p>
</div>
</div>
<div id="procesamientoModIIprediccion" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Predicción de riesgo<a href="a-tibble-32-11.html#procesamientoModIIprediccion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>A partir del resultado del matching coyuntural se realiza la predicción del riesgo para cada uno de los centros de trabajo</strong>. Esto se hace mediante la aplicación de un script que, utilizando los resultados del modelo predictivo previamente entrenado, genera la probabilidad de riesgo de incumplimiento de las normativas laborales para determinadas submaterias, además de generar una predicción de riesgo general para cada centro de trabajo.</p>
<p><strong>La actualización del universo de CT (primer paso de este módulo) y/o la imputación de los indicadores coyunturales (segundo paso) no se reflejarán en la MPR si no se realiza la predicción de riesgo con base en el modelo entrenado.</strong></p>
<div id="inputpred" class="section level4 unnumbered hasAnchor">
<h4>Entradas - Inputs<a href="a-tibble-32-11.html#inputpred" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>La predicción de riesgo tiene dos insumos principales: Primero, el output del matching coyuntural (paso previo),</strong> mismo que como se ha descrito, incluye el universo de CT del DNE actualizado. Recordar los tipos de columna y los factores que explican su inclusión para la generación de este output.</p>
<p><strong>El segundo insumo para la predicción de riesgo es el modelo entrenado</strong>. El modelo se entrena en el módulo IV, pero en este último paso del módulo II se incorpora a efectos predictivos únicamente. Es decir, para la predicción de riesgo hay que tener al menos un modelo entrenado previamente. AIR entrega el SIDIL con el modelo random forest ya entrenado.</p>
</div>
<div id="scriptpred" class="section level4 unnumbered hasAnchor">
<h4>Aplicación de scripts<a href="a-tibble-32-11.html#scriptpred" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El único script que se ejecuta en esta etapa del proceso es el de predicción.</strong> Se llama prediccion_modelo_v.py. Como indica su terminación es un script programado en Python, mismo que se puede operar desde la interfaz de automatización, desde la terminal o cmd, o desde R Studio a través de la paquetería lubridate (como los otros scripts en este lenguaje).</p>
<p><strong>En términos simplificados, este script recupera el modelo entrenado, mismo que puede ser interpretado como un conjunto de “coeficientes” de riesgo asociados a cada uno de los atributos e indicadores que entraron al modelo</strong> y que están disponibles en el Universo de CT con Indicadores (output del paso anterior) para hacer interactuar dichos coeficientes con el valor coyuntural de dichos atributos e indicadores y así generar una predicción.</p>
<p><strong>La predicción que se realiza en este paso es múltiple e independiente, por un lado, y compuesta, por el otro.</strong> Es múltiple e independiente en cuanto a que a cada CT se le predice una probabilidad de incumplimiento por submateria, independientemente de la probabilidad de incumplimiento laboral en otras submaterias. Esta predicción se realiza a todos los CT del universo consultado del DNE.</p>
<p><strong>Por otro lado, es compuesta porque hay una última predicción que se realiza para representar el riesgo de incumplimiento en cualquiera de las submaterias que conforman el marco normativo.</strong> Esto es lo que la hace “compuesta”, y representa la probabilidad de incumplimiento en alguna de las submaterias para las cuales hay registros de inspecciones previas. También en este caso, la predicción se realiza a todos los CT del universo consultado del DNE.</p>
<p>El script consiste en:</p>
<ul>
<li><p>Importación de paqueterías, definición de fecha (v), directorios y log de salida</p></li>
<li><p>Definición de funciones “básicas”, incluyendo: función de redondedo, cálculo de missing, ordenamiento de columnas, lectura de tablas en formato rds, renombrado de variables, etc.</p></li>
<li><p>Definición de función específica: generación de dataframe con predicciones, misma que recupera las predicciones por submateria y una predicción general, según el tipo de modelo, las ordena adecuadamente y agrega prefijos a los campos atributos, indicadores y predicciones.</p></li>
<li><p>Identificación del Universo de CT con indicadores generado más recientemente.</p></li>
<li><p>Identificación del modelo entrenado más recientemente, así como los archivos auxiliares a este.</p></li>
<li><p>Utilización del modelo para la predicción y aplicación de la función que ordena probabilidades.</p></li>
<li><p>Exportación de la MPR, ya con los prefijos atrib_, ind_ y pred_ incorporados, mismo que facilita la interpretación por parte de la interfaz de consulta.</p></li>
</ul>
</div>
<div id="frecuenciapred" class="section level4 unnumbered hasAnchor">
<h4>Frecuencia de actualización y propuesta de calendarización<a href="a-tibble-32-11.html#frecuenciapred" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La predicción debe realizarse al menos una vez cada tres meses, pero sólo después de haber actualizado el universo de CT consultado del DNE y el matching coyuntural, los dos pasos previos en este módulo.</p>
</div>
<div id="outputpred" class="section level4 unnumbered hasAnchor">
<h4>Salidas - Outputs - Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputpred" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El resultado de este script es la propia Matriz de Predicción de Riesgos (MPR).</strong> Esta matriz es, en esencia, el resultado del match coyuntural descrito en la subsección anterior, sumando dos nuevos tipos de columna: l<strong>as columnas que comienzan su nombre con pred_ son aquellas que contienen la predicción a nivel submateria, considerando la independencia mencionada anteriormente, mientras que la columna que se llama “riesgo” refleja la predicción de incumplimiento “compuesto”,</strong> es decir, la probabilidad de encontrar una violación laboral procedente en alguna de las submaterias.</p>
<p>Además, la matriz de predicción de riesgo contiene información adicional perteneciente al CT sobre el cual se hace dicha predicción. En la segunda fila, y solo en las columnas con la predicción de la submateria se incluye una métrica que se calcula a partir del error absoluto medio ó MAE por sus siglas en inglés. Dicha métrica fue calculada, tomando en cuenta que, al aplicar un threshold, la predicción de riesgo a nivel submateria se transforma en una variable dicotómica. Por lo que el MAE entre menor sea, más cerca de 1 será dicha métrica hibrida.</p>
<p>Con los datos disponibles a enero 2023la MPR consta de poco más de 600 mil registros y es importante resaltar que para los datos descriptivos a nivel centro de trabajo que pudieran entrar o no al modelo para la predicción del riesgo a nivel submateria o nivel centro de trabajo, se cuenta con una codificación en donde –1 significa valor faltante, esta codificación le permite al modelo discernir de dicho valor. La predicción de riesgo de cada CT para cada submateria es una estimación independiente.</p>
</div>
</div>
</div>
<div id="procesamientoModIyIIinterfazAuto" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Interfaz de automatización: Módulos I y II<a href="a-tibble-32-11.html#procesamientoModIyIIinterfazAuto" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>En este capítulo se presentan las instrucciones de operación de la interfaz de automatización. La ubicación de esta sección a esta altura del manual no es casualidad, toda vez que la misma únicamente tiene el propósito de simplificar el proceso de actualización de los módulos I y II, sin ser realmente un módulo adicional ya que no genera un contenido distinto al de dichos módulos (a diferencia del capítulo siguiente que, además de tener otro tipo de usuario, la UTD en lugar de la DGIET) sí genera nuevos subconjuntos de la MPR.</p>
<div id="propositointerfaz1" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Propósito de la interfaz<a href="a-tibble-32-11.html#propositointerfaz1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El propósito de esta interfaz es facilitar las tareas del SIDIL a cargo de la Dirección General de Investigación y Estadísticas del Trabajo (DGIET) de la STPS. Estas tareas comprenden: la carga de insumos originales de las fuentes de información estadísticas; el mantenimiento y actualización de los catálogos; y la ejecución de procesos de actualización coyunturales (generación de indicadores, matching, entre otros). Estos procesos desembocan en la creación de la Matriz de Predicción de Riesgo (MPR) que será enviada y consultada a la matriz consulta.</p>
</div>
<div id="accesointerfaz1" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Acceso a la interfaz<a href="a-tibble-32-11.html#accesointerfaz1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>El acceso a la interfaz requiere de tener un usuario y contraseña habilitado. En caso de no contar con estas credenciales, contactar a <a href="mailto:XXXX@stps.gob.mx" class="email"><mark>XXXX@stps.gob.mx</mark></a><mark>. El acceso a esta interfaz es a través de la siguiente liga XXXX.</mark></p>
</div>
<div id="organizacioninterfaz1" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Organización de la interfaz<a href="a-tibble-32-11.html#organizacioninterfaz1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La interfaz tiene tres pestañas que organizan los procesos de procesamiento de datos y generación de la MPR.</p>
<ol style="list-style-type: decimal">
<li><p><em>Carga insumos originales</em>: Esta es la primera pestaña que se despliega al momento de acceder a la interfaz. En esta sección se cargan los insumos originales que servirán para la posterior ejecución de procesos que se deben ejecutar de manera periódica.</p></li>
<li><p><em>Carga de catálogos</em>: Esta pestaña permite la carga y descarga de los diversos catálogos utilizados en el SIDIL para su actualización y mantenimiento, cuando sea necesario.</p></li>
<li><p><em>Estatus y ejecución de procesos</em>: En esta pestaña se visualiza la fecha y estatus de todos los procesos coyunturales del SIDIL, así como se ejecutan los mismos. Utiliza los últimos insumos originales disponibles, así como las últimas versiones de los catálogos, para ejecutar los diversos procedimientos de cálculo que culminan con la creación y envío de la MPR .</p></li>
</ol>
<div class="figure"><span style="display:block;" id="fig:interfaz1-1"></span>
<img src="images-1/04/interfaz1-1.png" alt="Página principal de la Interfaz de Automatización." width="80%" />
<p class="caption">
Recuadro 5.2: Página principal de la Interfaz de Automatización.
</p>
</div>
<div id="interfaz1-1" class="section level4 unnumbered hasAnchor">
<h4>Primera pestaña: Carga de insumos originales<a href="a-tibble-32-11.html#interfaz1-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Esta pestaña permite cargar los insumos originales más recientes para que puedan ser utilizados en procesos posteriores. Cuenta con cuatro secciones: <em>selección de la fuente de información, selección de periodo, selección de archivo y resumen de la carga</em>. En su conjunto, estas secciones permiten al usuario asegurarse de que se cargue el archivo correcto para cada proceso, identificando fuente de información y periodo para cada uno de los insumos originales.</p>
<p>En la primera sección de esta pestaña se puede seleccionar la fuente de información que se desea actualizar, bien sea del INEGI (Censo Económico y ENOE) o IMSS. Como se puede observar en la siguiente imagen, la interfaz permite guardar una a una las tablas correspondientes a las tres fuentes de información con las que actualmente trabaja el SIDIL:</p>
<ul>
<li><p>Censo Económico (CE): Una (1) tabla con la información correspondiente a los tres centros de trabajo más grandes por municipio y rama (SCIAN 2 dígitos). Esta tabla fue producida en colaboración entre la STPS y el INEGI, y su actualización debe seguir el mismo formato que la tabla establecida en el CE 2019.</p></li>
<li><p>ENOE: Tres (3) tablas de la ENOE (COE1, COE2 y SDEM) las cuales deben ser cargadas en formato .dbf. La publicación de estas tablas las realiza INEGI con frecuencia trimestral.</p></li>
<li><p>IMSS: Tres (3) tablas del IMSS (patrones, puestos, accidentes (riesgos)) que pueden ser cargadas en diversos formatos. Los formatos aceptados son .csv, .tab, .rar, .7z en el caso de patrones y puestos (de publicación mensual), y .xlsx o .csv en el caso de accidentes (riesgos) – de publicación esporádica.</p></li>
</ul>
<div class="figure"><span style="display:block;" id="fig:interfaz1-2"></span>
<img src="images-1/04/interfaz1-2.png" alt="Sección Carga de insumos originales. Pestaña: Carga de insumos originales." width="80%" />
<p class="caption">
Recuadro 5.3: Sección Carga de insumos originales. Pestaña: Carga de insumos originales.
</p>
</div>
<p>Una vez seleccionada la fuente de información que se desea actualizar, se procede a seleccionar el periodo de la nueva actualización. Los periodos varían según la fuente de información. Para el caso de la ENOE se despliegan los trimestres de cada año, en el caso del IMSS se muestran los meses de cada año y, finalmente, para el censo económico, la temporalidad del periodo es quinquenal. Notar que se muestran algunos periodos anteriores y posteriores a la fecha actual, dando un poco de margen al usuario para que pueda subir al sistema insumos anteriores o muy recientes con los que cuente la DGIET.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-3"></span>
<img src="images-1/04/interfaz1-3.png" alt="Sección Selección del periodo. Pestaña: Carga de insumos originales." width="80%" />
<p class="caption">
Recuadro 5.4: Sección Selección del periodo. Pestaña: Carga de insumos originales.
</p>
</div>
<p>Posteriormente, en la sección de seleccionar el archivo, se desplegará una ventana de los archivos de la PC al hacer click en el botón de “seleccionar”. En este cuadro de diálogo se podrá seleccionar el archivo que se desea subir. El archivo seleccionado debe coincidir con la información proporcionada en las secciones anteriores. Una vez seleccionado, dar click en “open” o “abrir”.</p>
<p>Notar que:</p>
<ol style="list-style-type: decimal">
<li><p>De cargar archivos ya existentes para el periodo de referencia y tipo de insumo, el sistema sobreescribirá dichos insumos.</p></li>
<li><p>Según el tipo de fuente y periodo de referencia indicado, el insumo se guardará con un nombre determinado. Esto es independiente del nombre que el archivo original tenga en el dispositivo de quien esté subiendo la información. Y por supuesto, tiene implicaciones en cuanto a la veracidad de la información. Aunque el usuario se equivoque y seleccione de la ENOE 1T 2022 el insumo SDEM….dbf, si en las opciones de la interfaz indica que la información corresponde a ENOE <em>2</em>T 202<em>3</em> para el insumo <em>COE1</em>, en el sistema se almacenará con las especificaciones de lo segundo.</p></li>
</ol>
<div class="figure"><span style="display:block;" id="fig:interfaz1-4"></span>
<img src="images-1/04/interfaz1-4.png" alt="Ventana de diálogo desplegada para seleccionar el archivo del insumo. Sección: Selección del archivo. Pestaña: Carga de insumos originales." width="80%" />
<p class="caption">
Recuadro 5.5: Ventana de diálogo desplegada para seleccionar el archivo del insumo. Sección: Selección del archivo. Pestaña: Carga de insumos originales.
</p>
</div>
<p>Cuando se haya seleccionado y abierto el archivo este se empieza a subir al sistema. La barra azul de la sección muestra el avance de la carga del insumo desde la computadora local al servidor.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-5"></span>
<img src="images-1/04/interfaz1-5.png" alt="Avance de carga del archivo. Sección: Selección del archivo. Pestaña: Carga de insumos originales." width="80%" />
<p class="caption">
Recuadro 5.6: Avance de carga del archivo. Sección: Selección del archivo. Pestaña: Carga de insumos originales.
</p>
</div>
<p><strong>En el recuadro “Resumen de la carga” se observan los resultados preliminares de los pasos anteriores, quedando pendiente la confirmación del usuario.</strong> Es decir, una vez se completa la barra azul, confirma que el archivo está listo para ser cargado, pero <strong>no se verá reflejado en el servidor hasta en tanto el usuario presione el botón de “guardar archivo”,</strong> mismo se encuentra debajo de la información que se despliega para una última revisión del usuario.</p>
<p>En este ejemplo se puede observar en el recuadro de información de <em>Resumen de la carga</em> que se ha seleccionado la fuente INEGI-ENOE SDEM del periodo 2023 T2, el cual se poblará con el archivo seleccionado “ENOE_SDEMT223.dbf”. Una vez revisada y validada esta información por parte del usuario, comprobando que efectivamente el archivo cargado corresponda con la información seleccionada, se puede guardar el archivo dando click al botón.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-6"></span>
<img src="images-1/04/interfaz1-6.png" alt="Sección Resumen de la Carga y guardado de archivos seleccionados. Pestaña: Carga de insumos originales." width="80%" />
<p class="caption">
Recuadro 5.7: Sección Resumen de la Carga y guardado de archivos seleccionados. Pestaña: Carga de insumos originales.
</p>
</div>
<p>Una vez guardado el archivo se despliega un mensaje confirmatorio en la parte inferior de la pestaña. Cuando esté cargado el archivo se puede proceder a cargar un nuevo insumo o continuar a otra pestaña para ejecutar algún otro proceso. El mensaje confirmatorio únicamente indicaría, en este caso, “ENOEN_SDEMT223.dbf guardado”.</p>
</div>
<div id="interfaz1-2" class="section level4 unnumbered hasAnchor">
<h4>Segunda prestaña: Actualización de catálogos<a href="a-tibble-32-11.html#interfaz1-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La segunda pestaña de la interfaz es la de <em>Actualización de catálogos</em>, la cual cuenta con dos grandes secciones: <em>descarga</em> y <em>carga</em> de catálogos.</p>
<p>¿Qué se entiendo por un <em>catálogo</em> en el SIDIL? Los catálogos son documentos de tipo .xlsx que dan sentido, facilitan el mantenimiento e interpretación de información, y homologan los campos presentados en otras fuentes de información. Por ejemplo, las etiquetas asociadas al marco geoestadístico de municipios y entidades del país, producido por INEGI. Para mas información consultar la sección 1 (CATALOGOS DE INFORMACION).</p>
<div id="interfaz1-3" class="section level5 unnumbered hasAnchor">
<h5>Sección Descarga de catálogos<a href="a-tibble-32-11.html#interfaz1-3" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El objetivo de esta sección es ofrecer la posibilidad de descarga de cualquier catálogo en su versión actual (vigente) o en su versión anterior, para así poder verificar qué versión está siendo utilizada o cuál fue la versión previa a la versión actual. De esta manera, se resguardan todas las versiones de los catálogos en el sistema y se puede mantener una supervisión de éstas para evitar que se resguarden copias de los catálogos en algún otro sitio fuera del servidor esta interfaz.</p>
<p>Se sugiere enfáticamente que para modificar un catálogo se sigan los siguientes pasos:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Acceder a la pestaña de carga de catálogos y descargar la versión actual en la sección de descarga.</p></li>
<li><p>La versión actual se procesa fuera de línea, identificando y realizando los cambios necesarios.</p></li>
<li><p>Se sube el nuevo catálogo utilizando la sección “Carga” que se describe más abajo</p></li>
<li><p>En caso de errores (subir una versión equivocada, por ejemplo), es posible recuperar la versión anterior al cambio realizado, presionando el botón “Descargar versión previa”.</p></li>
</ol>
<div class="figure"><span style="display:block;" id="fig:interfaz1-7"></span>
<img src="images-1/04/interfaz1-7.png" alt="Pestaña de carga de catálogos." width="80%" />
<p class="caption">
Recuadro 5.8: Pestaña de carga de catálogos.
</p>
</div>
</div>
<div id="interfaz1-4" class="section level5 unnumbered hasAnchor">
<h5>Sección Carga<a href="a-tibble-32-11.html#interfaz1-4" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>En esta sección se realiza la carga de las nuevas versiones de los catálogos que requieran cambios. Primero se selecciona el catálogo de la lista desplegable, el nombre del catálogo seleccionado se mostrará a continuación de la lista, este nombre será el que se le asignará al archivo que posteriormente será seleccionado.</p>
<p>Luego, en la sección de selección del archivo, se desplegará una ventana de diálogo al dar click en el botón de “seleccionar”, en esta pestaña se deberá seleccionar el archivo correspondiente y dar click en “open” o “abrir”.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-8"></span>
<img src="images-1/04/interfaz1-8.png" alt="Sección de carga de archivos. Pestaña Carga de catálogos." width="80%" />
<p class="caption">
Recuadro 5.9: Sección de carga de archivos. Pestaña Carga de catálogos.
</p>
</div>
<p>Una vez seleccionado el archivo se mostrará el proceso de lectura en la barra azul. Cuando la lectura del archivo termine, la barra azul mostrará el texto “Archivo listo para ser cargado”. <strong>En este punto el archivo aún no está cargado en el sistema</strong>. <strong>Para culminar con la carga del archivo, se deberá dar click en el botón de “Guardar archivo” ubicado en el recuadro de Resumen</strong>. Una vez revisada la información de dicho recuadro, el cual muestra el nombre del catálogo que se quiere actualizar y el nombre del archivo que se seleccionó para su actualización, con esta acción se guardará el archivo.</p>
<p>Como ya se mencionó con anterioridad, si en este punto se sube por equivocación un archivo erróneo se deberá subir de nuevo el archivo correcto, cerciorándose finalmente que la versión errónea haya quedado como versión previa y la nueva y correcta como versión actual (esto se puede realizar en la sección de descarga). Esto último da cuenta de la importancia del botón para “Descargar versión previa”, toda vez que permitiría descargar el resguardo en caso de error.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-9"></span>
<img src="images-1/04/interfaz1-9.png" alt="Carga de un nuevo archivo. Sección de carga. Pestaña de Carga de catálogos." width="80%" />
<p class="caption">
Recuadro 5.10: Carga de un nuevo archivo. Sección de carga. Pestaña de Carga de catálogos.
</p>
</div>
<p>Finalmente, cuando se guarda el archivo se despliega un mensaje confirmatorio en la parte inferior de la pantalla. De esta manera, se puede proceder a cargar un nuevo catálogo o ir a otra pestaña para ejecutar otro proceso.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-10"></span>
<img src="images-1/04/interfaz1-10.png" alt="Mensaje de confirmación de carga de catálogos. Pestaña de Carga de catálogos." width="80%" />
<p class="caption">
Recuadro 5.11: Mensaje de confirmación de carga de catálogos. Pestaña de Carga de catálogos.
</p>
</div>
</div>
</div>
<div id="interfaz1-5" class="section level4 unnumbered hasAnchor">
<h4>Tercera pestaña: Ejecución de procesos<a href="a-tibble-32-11.html#interfaz1-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La tercera pestaña es la de <em>Estatus y ejecución de procesos</em>. El objetivo de esta sección es ejecutar todos los procesos necesarios para generar la Matriz de Predicción de Riesgo. Se sugiere que la ejecución de estos procesos se realice trimestralmente.</p>
<div id="interfaz1-6" class="section level5 unnumbered hasAnchor">
<h5>Estatus de fuentes y procesos<a href="a-tibble-32-11.html#interfaz1-6" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>La primera sección es la de <em>Estatus de fuentes de procesos</em> la cual muestra una tabla que da cuenta del estatus de actualización de cada tabla por fuente de información, incluyendo la versión actual que está cargada en el sistema y la versión esperada de acuerdo con la calendarización de la publicación. Cuando la versión actual coincide con la versión esperada se toma su estatus como “actualizado”, cuando no coinciden las dos versiones, es decir, se espera que haya una nueva publicación de la fuente de información que aún no se ha subido al sistema, el estatus de dicha tabla se muestra como “posible actualización disponible”, lo que indica que se debe iniciar por la carga de insumos originales (primera pestaña de la interfaz) y posteriormente ejecutar los procesos correspondientes para la actualización del SIDIL.</p>
<p>Notar que las fechas de las versiones esperadas son aproximadas siguiendo con la regularidad con la que hasta ahora se hace la publicación de las fuentes de información. Si la DGIET aún no cuenta con la fuente de información, pero el sistema ya anuncia una posible actualización disponible, no causa ningún inconveniente esperar a que se cuente con los datos originales actualizados para ejecutar los procesos.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-11"></span>
<img src="images-1/04/interfaz1-11.png" alt="Sección de Estatus de fuestes y procesos. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.12: Sección de Estatus de fuestes y procesos. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
</div>
<div id="interfaz1-7" class="section level5 unnumbered hasAnchor">
<h5>Procesos<a href="a-tibble-32-11.html#interfaz1-7" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>La siguiente sección es la de <em>Procesos</em>, donde se muestra una tabla con la información de todos los procesos que se ejecutan en el SIDIL, la versión del código que se utiliza, el último periodo de referencia, la última actualización y el último mensaje confirmatorio. Esta tabla le permite al usuario revisar los detalles de la última ejecución realizada de cada uno de los procesos y la pertinencia de una nueva ejecución.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-12"></span>
<img src="images-1/04/interfaz1-12.png" alt="Sección Procesos. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.13: Sección Procesos. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
</div>
</div>
</div>
<div id="interfaz1-8" class="section level3 unnumbered hasAnchor">
<h3>Procesamiento de información<a href="a-tibble-32-11.html#interfaz1-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La siguiente sección es la de <em>Procesamiento de información</em>, es en esta sección que se ejecutan todos los procesos que sean pertinentes actualizar posterior análisis de la tabla de información de procesos. En la parte izquierda de la sección se encuentra la lista de los procesos que se pueden ejecutar, estos se dividen en dos: actualización de fuentes y procesamiento de datos. Notar que el orden en el que se encuentran los procesos importa. Primero se ejecutará la actualización de fuentes (una o más según lo seleccionado), seguida por el procesamiento de datos. Esto es independiente del orden en el que el usuario los “active” o seleccione. Por supuesto, únicamente aplica a la sesión que se sostenga con la interfaz, es decir, si en una primera sesión se actualiza la “Consulta al DNE” y en la siguiente sesión únicamente se actualiza “INEGI-ENOE”, sin seleccionar “Consulta al DNE”, entonces el cálculo de los nuevos indicadores de la ENOE no se verá reflejado en la MPR. Ni tampoco la MPR tendrá cambios en su dimensión si no se corren los últimos dos procesos.</p>
<p>En consecuencia, se sugiere la ejecución trimestral de los procesos de manera “completa”, es decir, si se actualiza INEGI-ENOE o IMSS entonces también se deben seleccionar para ejecución los últimos tres procesos.</p>
<p>Una vez seleccionados todos los procesos que se desean correr, dar click en el botón “Ejecutar” para que inicie el procesamiento.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-13"></span>
<img src="images-1/04/interfaz1-13.png" alt="Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.14: Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
<p>Cuando se ejecutan los procesos, el avance de estos se va mostrando en la consola de seguimiento ubicada en el costado derecho de la pantalla. Esta consola reportará los principales hitos y resultados de cada proceso, hasta finalizar con el producto final y con el mensaje de cierre de cada uno. Lo que se imprime en consola formará parte de lo que se resguardará en el log (archivo .txt) de cada proceso. En caso de haber algún error al ejecutar algún script de los procesos también se verá reflejado en la consola.</p>
<p>Sin embargo, notar que en la consola de la interfaz únicamente se muestran aquellos mensajes “de alto nivel” que, desde el script, se configuraron para identificarse con tres <em>hashes</em> (“###”). Mientras que en el log se imprimen todos los mensajes y resultados generados en el procesamiento de la información, en la consola de la interfaz únicamente se muestran aquellos que llevan los tres <em>hashes</em>.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-14"></span>
<img src="images-1/04/interfaz1-14.png" alt="Consola de seguimiento. Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.15: Consola de seguimiento. Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
<p>Algunos procesos pueden tardar varios minutos, incluso horas, es por esto que mientras el proceso se está ejecutando se muestra un mensaje en la esquina derecha de la pantalla el cual da cuenta de este procesamiento en curso.</p>
<p>Los procesos de “Imputación y enriquecimiento” y de “Aplicación de modelo para MPR” se ejecutan en Python y su despliegue en consola no se presenta en tiempo real, sino únicamente al finalizar el proceso. El primero de estos dos procesos tarda aproximadamente 30 minutos, mientras que el segundo de ellos aproximadamente 10 minutos (medido con base en los aproximadamente 617 mil registros de CT en el DNE y los 18 indicadores laborales).</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-15"></span>
<img src="images-1/04/interfaz1-15.png" alt="Mensaje de proceso en ejecución o corriendo. Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.16: Mensaje de proceso en ejecución o corriendo. Sección de Procesamiento de información. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
<div id="interfaz1-9" class="section level4 unnumbered hasAnchor">
<h4>Descarga de la información<a href="a-tibble-32-11.html#interfaz1-9" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Cuando terminan de correr los procesos seleccionados (<mark>siempre y cuando se haya seleccionado y ejecutado el proceso de Aplicación de modelo para MPR),</mark> se habilitan los botones de la sección de <em>Descarga de información</em>, los cuales permiten descargar la Matriz de Predicción de Riesgo (MPR) y el botón de <em>Enviar última versión de MPR a interfaz de consulta.</em> El primer botón de descarga permite al usuario visualizar la MPR generada para cerciorarse de que se hayan realizado todos los procesos correctamente (la matriz está poblada, cuenta con todas las columnas esperadas, etc.). Una vez revisada, la MPR puede ser enviada a la interfaz de consulta para su análisis y uso. Esto último despliega un mensaje confirmatorio emergente, mientras que en el <em>back</em> se deposita la MPR con ciertos metadatos en la carpeta <em>3_resultados/MPR/consulta</em> en un archivo de varios dataframes con la fecha de envío.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz1-16"></span>
<img src="images-1/04/interfaz1-16.png" alt="Sección Descarga de información. Pestaña de Estatus y ejecución de procesos." width="80%" />
<p class="caption">
Recuadro 5.17: Sección Descarga de información. Pestaña de Estatus y ejecución de procesos.
</p>
</div>
</div>
</div>
</div>
<div id="procesamientoModIIIinterfazConsulta" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Módulo III: Priorización de los centros de trabajo<a href="a-tibble-32-11.html#procesamientoModIIIinterfazConsulta" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="propositointerfaz2" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Propósito de la interfaz<a href="a-tibble-32-11.html#propositointerfaz2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para facilitar la exploración y priorización de los centros de trabajo del DNE con mayores probabilidades de tener infracciones se generó una interfaz de consulta de la Matriz de Predicción de Riesgo. Esta interfaz permite filtrar y descargar la MPR de manera sencilla basadas en estrategias inteligentes de inspecciones.</p>
</div>
<div id="accesointerfaz2" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Acceso a la interfaz<a href="a-tibble-32-11.html#accesointerfaz2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para poder acceder a la interfaz de consulta del SIDIL se debe acceder con el usuario y contraseña asignados. Únicamente si el usuario cuenta con los permisos correspondientes puede acceder a la interfaz.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-2"></span>
<img src="images-1/04/interfaz2-2.png" alt="Página principal de la interfaz." width="80%" />
<p class="caption">
Recuadro 5.18: Página principal de la interfaz.
</p>
</div>
</div>
<div id="interfaz2-1" class="section level3 unnumbered hasAnchor">
<h3>Primera prestaña: Filtrado<a href="a-tibble-32-11.html#interfaz2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Una vez se accede a la interfaz para seleccionar los centros de trabajo a inspeccionar el usuario puede ver dos pestañas, la primer de “Filtrado” y la segunda de “Análisis”. La pestaña de Filtrado cuenta con cuatro secciones: predictores, indicadores, atributos y selección aleatoria y exportación de la matriz. En la pestaña de Análisis se encuentran las secciones de criterios de filtrado, distribución de centros de trabajo por estado, distribución de centros de trabajo por tamaño y estadísticas de la matriz.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-3"></span>
<img src="images-1/04/interfaz2-3.png" alt="Primera pestaña: Filtrado." width="80%" />
<p class="caption">
Recuadro 5.19: Primera pestaña: Filtrado.
</p>
</div>
<p>La pestaña de Filtrado inicia con un texto que indica cuántos centros de trabajo están disponibles en la matriz de predicción de riesgo que se está trabajando, así como la fecha de generación de dicha matriz. Este será el universo sobre el cual se aplicarán los filtros que el usuario considere según la estrategia de inspección. A medida que se apliquen los filtros, este número irá disminuyendo.</p>
<p>Posteriormente se encuentra la sección de predictores, la cual permite al usuario seleccionar una de las submaterias de Condiciones Generales de Trabajo sobre las cuales se realizó una predicción y filtrar los centros de trabajo a partir de la probabilidad de riesgo calculada. En el menú desplegable se selecciona una submateria o predictor, posteriormente se muestra la distribución de la predicción de la submateria (el primer cuartil, la media, la mediana y el tercer cuartil). En la barra se muestra esta distribución, la cual va de 0 a 1, aquí se puede seleccionar el rango que el usuario desee, recordando que entre mayor sea el valor de la predicción mayor es la probabilidad de encontrar infracciones en esta submateria.</p>
<p>En el ejemplo de la imagen se selecciona el predictor o la submateria de Contratación, y se hace una selección del valor de 0.19 (el valor de la mediana) al 0.4391 (el máximo valor) y se da click en el botón de “seleccionar predictor”. Una vez seleccionados podemos ver que hemos seleccionado 327,221 centros de trabajo que tienen una probabilidad de tener violaciones en la submateria de contratación de entre el 19% y el 43.9%.</p>
<p>De manera predeterminada la interfaz mostrará la selección en la barra de la mediana al valor máximo, no obstante, esta selección puede ser cambiada por el usuario según su criterio. Cabe resaltar que a medida que la selección sea más estricta (centros de trabajo con mayor valor de predicción o mayor probabilidad de riesgo), el total de centros de trabajo resultante del filtrado será menor.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-4"></span>
<img src="images-1/04/interfaz2-4.png" alt="Sección Predictores. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.20: Sección Predictores. Pestaña Filtrado.
</p>
</div>
<p>Si se requiere cambiar la selección realizada se puede hacer dando click al objeto de la lista (en azul en la imagen) y posteriormente dando click en el botón de “Quitar seleccionado”. De esta manera se limpiará la sección y se podrá realizar otra selección. <mark>Cabe destacar que en esta sección solo se podrá elegir un predictor o submateria en cada consulta.</mark></p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-5"></span>
<img src="images-1/04/interfaz2-5.png" alt="Opción de quitar selección. Sección Predictores. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.21: Opción de quitar selección. Sección Predictores. Pestaña Filtrado.
</p>
</div>
<p>En la siguiente sección se pueden aplicar filtros de indicadores laborales calculados en el SIDIL. En la barra desplegable se pueden seleccionar el indicador, del cual se mostrará la distribución del indicador (el primer cuartil, la media, la mediana y el tercer cuartil) y una descripción del indicador seleccionado. Posteriormente se encuentra la barra los valores del indicador que van de 0 a 1, la cual permite seleccionar los centros de trabajo con mayores valores del indicador.</p>
<p>En el ejemplo de la imagen se seleccionar el indicador “Falta de acceso a prestaciones sociales” con el rango 0.21 a 1. Con esta selección obtenemos los centros de trabajo con mayor probabilidad de encontrar falta de acceso a prestaciones sociales. Al dar click al botón “agregar indicador” se puede observar que el total de centros de trabajo es de 193,314.</p>
<p>En esta sección se puede seleccionar y agregar má de un indicador, según lo considere el criterio del usuario. En todos los casos, la escala de los indicadores va de 0 a 1, donde 1 es mayor probabilidad de encontrar alguna de las problemáticas medidas por los indicadores en los centros de trabajo.</p>
<p>Al igual que en la sección anterior, si se quiere modificar alguna selección de indicador se pueden quitar indicadores ya seleccionados y modificar los filtros.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-6"></span>
<img src="images-1/04/interfaz2-6.png" alt="Sección Indicadores. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.22: Sección Indicadores. Pestaña Filtrado.
</p>
</div>
<p>La siguiente sección de la pestaña es la de atributos en la cual se pueden aplicar filtros de atributos propios de los centros de trabajo la cual se encuentra en el DNE. Entre estos se encuentran: si es prioritario, si está en DECLARE, prima de riesgo, rama industrial, actividad del SCIAN, estado, municipio, entre otros. Se puede agregar más de un atributo como filtro. Como en las secciones anteriores, se añaden con el botón “agregar atributo” y se pueden quitar seleccionando los objetos y dando click en “quitar atributo”.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-7"></span>
<img src="images-1/04/interfaz2-7.png" alt="Sección Atributos. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.23: Sección Atributos. Pestaña Filtrado.
</p>
</div>
<div id="interfaz2-2" class="section level4 unnumbered hasAnchor">
<h4>Aleatorizacion de la selección<a href="a-tibble-32-11.html#interfaz2-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La última sección es la de aleatorización y descarga de la matriz. Al inicio se muestra el total de centros de trabajo resultado de la aplicación de filtros. También se brinda la opción de seleccionar de forma aleatoria una parte del resultado. En el ejemplo de la imagen se muestra que la matriz final después de los filtros aplicados es de 185 centros de trabajo en 23 estados, si se requiere un número menor, se escribe en la barra para que se seleccionen de manera aleatoria de la matriz.</p>
<p>Antes de exportar la tabla se sugiere revisar la pestaña de análisis, la cual se describe a continuación.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-8"></span>
<img src="images-1/04/interfaz2-8.png" alt="Aleatorización. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.24: Aleatorización. Pestaña Filtrado.
</p>
</div>
</div>
</div>
<div id="interfaz2-3" class="section level3 unnumbered hasAnchor">
<h3>Segunda pestaña: Analisis<a href="a-tibble-32-11.html#interfaz2-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La pestaña de análisis se encuentra en la parte superior de la interfaz, junto con el título de Filtrado.</p>
<p>La primera sección de la pestaña es la de Criterios de filtrado, la cual muestra un resumen de los filtros aplicados a la matriz.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-9"></span>
<img src="images-1/04/interfaz2-9.png" alt="Pestaña Análisis." width="80%" />
<p class="caption">
Recuadro 5.25: Pestaña Análisis.
</p>
</div>
<p>La segunda sección muestra la distribución de los centros de trabajo seleccionados por estado, mediante una gráfica y una tabla.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-10"></span>
<img src="images-1/04/interfaz2-10.png" alt="Sección Distribución de Centros de Trabajo por Estado. Pestaña Análisis." width="80%" />
<p class="caption">
Recuadro 5.26: Sección Distribución de Centros de Trabajo por Estado. Pestaña Análisis.
</p>
</div>
<p>La terera sección muestra la distribución de los centros de trabajo seleccionados por tamaño, mostrando las seis categorías de tamaño que utiliza el SIDIL (de 0 a 10 personas trabajadoras, de 11 a 15, de 16 a 50, de 51 a 100, de 101 a 250 y 521 y más) y los valores faltantes (NA).</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-11"></span>
<img src="images-1/04/interfaz2-11.png" alt="Sección Distribución de Centros de Trabajo por Tamaño. Pestaña Análisis." width="80%" />
<p class="caption">
Recuadro 5.27: Sección Distribución de Centros de Trabajo por Tamaño. Pestaña Análisis.
</p>
</div>
<p>Finalmente, en esta pestaña también se encuentran las estadísticas de la matriz que se obtiene después de los filtros, donde se encuentra información como el número total de filas y columnas, el tipo de columnas (carácter o numérica), los valores faltantes, medidas de distribución de las variables numéricas, entre otros.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-12"></span>
<img src="images-1/04/interfaz2-12.png" alt="Sección Estadísticas de la matriz. Pestaña Análisis." width="80%" />
<p class="caption">
Recuadro 5.28: Sección Estadísticas de la matriz. Pestaña Análisis.
</p>
</div>
<p>Una vez revisada la información de la tabla se puede volver a la pestaña de filtrado para, o bien editar la selección realizada, o bien descargar la matriz filtrada. Para descarga la matriz resultante se debe dar click en el botón verde de “Exportar centros de trabajo seleccionados”. De esta manera, se descargará un archivo en formato .csv a la pestaña de descargas del equipo con el nombre “matriz_filtrada-aaaa-mm-dd”.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-13"></span>
<img src="images-1/04/interfaz2-13.png" alt="Exportar centros de trabajo seleccionados. Pestaña Filtrado." width="80%" />
<p class="caption">
Recuadro 5.29: Exportar centros de trabajo seleccionados. Pestaña Filtrado.
</p>
</div>
</div>
<div id="interfaz2-4" class="section level3 unnumbered hasAnchor">
<h3>Tabla final de resultados con sus pestañas<a href="a-tibble-32-11.html#interfaz2-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>En la tabla resultante se encuentra en la primera pestaña “matriz” el resultado de la matriz filtrada con los centros de trabajo seleccionados, identificados con el ID de cada uno, atributos, indicadores, probabilidades de riesgo en cada una de las submaterias y un riesgo general (probabilidad de encontrar violaciones laborales en cualquier submateria).</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-14"></span>
<img src="images-1/04/interfaz2-14.png" alt="Tabla final de resultados. Pestaña matriz." width="80%" />
<p class="caption">
Recuadro 5.30: Tabla final de resultados. Pestaña matriz.
</p>
</div>
<p>La segunda pestaña de la matriz “predictor” muestra el predictor o submateria seleccionado así como información sobre la selección o filtrado.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-15"></span>
<img src="images-1/04/interfaz2-15.png" alt="Tabla final de resultados. Pestaña predictor." width="80%" />
<p class="caption">
Recuadro 5.31: Tabla final de resultados. Pestaña predictor.
</p>
</div>
<p>La tercer pestaña “indicadores” muestra la información del filtro de indicadores aplicados. Y la cuarta “atributos”, sobre los filtros aplicados en esta sección. Si no se selecciona ningún filtro en alguna de las secciones, la pestaña quedará en blanco.</p>
<div class="figure"><span style="display:block;" id="fig:interfaz2-16"></span>
<img src="images-1/04/interfaz2-16.png" alt="Tabla final de resultados. Pestaña indicadores." width="80%" />
<p class="caption">
Recuadro 5.32: Tabla final de resultados. Pestaña indicadores.
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:interfaz2-17"></span>
<img src="images-1/04/interfaz2-17.png" alt="Tabla final de resultados. Pestaña atributos." width="80%" />
<p class="caption">
Recuadro 5.33: Tabla final de resultados. Pestaña atributos.
</p>
</div>
<p>*******VIDEO DE DEMO A SALAFRANCA***************</p>
</div>
</div>
<div id="procesamientoModIV" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Módulo IV: Entrenamiento del modelo<a href="a-tibble-32-11.html#procesamientoModIV" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="propositoModIV" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Propósito principal<a href="a-tibble-32-11.html#propositoModIV" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>El módulo IV tiene como objetivo principal entrenar el modelo predictivo que será utilizado para asignar probabilidades de ocurrencia de violaciones laborales por submateria a los centros de trabajo según sus características.</strong> El modelo de predicción se realiza a partir de lo observado en el pasado, de esta manera, se analizan registros de inspecciones desde el 2012 hasta lo más reciente disponible – actualmente principios de enero de 2023. La principal variable de interés, más allá del centro de trabajo, y la submateria, es si en el desahogo de la inspección se detectaron violaciones que proceden en las submaterias objetivo para, a partir de las características del centro de trabajo, entrenar el modelo.</p>
<p><strong>El modelo entrenado puede ser un modelo Random Forest o un modelo TabNet,</strong> ambos tipos de modelos son herramientas muy útiles para realizar predicciones a partir de datos tabulares. A continuación, se brinda una breve explicación de cada modelo:</p>
<p><strong>- Los modelos <em>random forest</em> o <em>bosque aleatorio</em>, se basan en la creación de un conjunto de árboles de decisión, cada uno de los cuales es entrenado para hacer predicciones sobre un conjunto de datos</strong>. Los resultados de cada árbol se combinan para formar la predicción final del modelo. Una de las principales ventajas de los bosques de decisión es su capacidad para manejar datos con un gran número de variables y realizar automáticamente muchas de las tareas de preprocesamiento de datos que normalmente se requieren para trabajar con este tipo de datos. Además, los bosques de decisión son generalmente muy resistentes al <em>overfitting</em> o sobreajuste, lo que significa que suelen tener un rendimiento consistente incluso cuando se utilizan con conjuntos de datos muy grandes.</p>
<p>Por otro lado, TabNet es otro modelo de aprendizaje automático basado en redes neuronales diseñado específicamente para trabajar con datos tabulares. Al igual que los bosques de decisión, TabNet es capaz de manejar automáticamente muchas de las tareas de preprocesamiento de datos que normalmente se requieren para trabajar con este tipo de datos. Además, TabNet es muy eficiente en términos de uso de memoria y tiene un rendimiento muy bueno en tareas de predicción de datos tabulares.</p>
<p>De manera preestablecida se dejará el modelo Random Forest, no obstante, esto se puede cambiar en el script de entrenamiento (Ver Parte 4 del presente capítulo).</p>
<p>Se requiere realizar cuatro actividades principales para llevar a cabo el módulo IV, estas son:</p>
<ul>
<li><p>Construcción de la serie histórica de inspecciones laborales (2012-2022)</p></li>
<li><p>Construcción de la serie histórica de indicadores laborales</p></li>
<li><p>Matching de las series históricas</p></li>
<li><p>Entrenamiento y evaluación del modelo de predicción.</p></li>
</ul>
</div>
<div id="procesamientoModIVSIAPI" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Construcción de la serie histórica de inspecciones laborales (2012-2022)<a href="a-tibble-32-11.html#procesamientoModIVSIAPI" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="inputsModIV" class="section level4 unnumbered hasAnchor">
<h4>Entradas - Inputs<a href="a-tibble-32-11.html#inputsModIV" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>El registro histórico de inspecciones que se obtienen del SIAPI-SIPAS es el principal insumo para la ejecución de este proceso.</strong> A la fecha, entre 2012 y 2023 se han registrado más de 1.1 millones de inspecciones distintas (según <em>inspeccion_id</em> - la variable que identifica de manera unívoca las inspecciones laborales).</p>
<p><strong>El SIAPI-SIPAS es un sistema de bases de datos relacionales almacenadas en SQL Server.</strong> Tiene múltiples entidades (tablas) relacionadas entre sí. Como en el DNE, es necesario acceder a él mediante una conexión ODBC/DBI que permita el envío y recolección de queries definidas conforme a los intereses de SIDIL. Así como en la consulta del DNE, en ningún momento se escribe información sobre las bases originales, únicamente se consulta la información mínima para el adecuado procesamiento de datos.</p>
<p><strong>Cabe notar que el registro histórico de inspecciones debe construirse toman en consideración una particularidad que se observa en el sistema.</strong> Coexisten en el SIAPI-SIPAS cinco diferentes instancias de la base de datos. Estas son:“SSI_DB_ReformaLaboral”, “SSI_DB_Prod”, SSI_DB_Prod_Rgitas”, “SSI_DB_SIAPI_ReFeSSAT_ Prod” y “SSI_DB_SIAPI_REFESSATV2”. El motivo por el cual coexisten estas cinco bases de datos excede los alcances de SIDIL; basta notar las implicaciones que tiene para la construcción del registro histórico. Una misma inspección (inspeccion_id) puede ser encontrada en más de una (sino las cinco) instancias de esta base de datos, toda vez que sobre la instancia original se fueron realizando sucesivas copias sin depuración de inspecciones posiblemente duplicadas.</p>
<p><strong>Por ello es que un paso crítico es la construcción de un índice de inspecciones, mismo que no es otra cosa que un registro que identifica en cuál de las cinco instancias mencionadas se encuentra por primera vez una inspeccion_id.</strong> Así, por ejemplo, si la inspección de id número 10001112 aparece por primera vez en la primera instancia, “SSI_DB_ReformaLaboral”, esta es la instancia en la que se esperaría que se registren todos los procedimientos de inspección y posiblemente de sanción posteriores al registro inicial de la inspección. Es decir, si esta misma inspección aparece nuevamente en otras instancias posteriores, por ejemplo, “SSI_DB_Prod”, no solamente es ignorada en dichas ocurrencias, sino que también todos los posibles registros del procedimiento inspectivo y/o sancionador asociados a ella. La regla es que allí (la instancia) donde aparece primero la inspección es donde se registra. Esto se debe a que esta es la instrucción que recibe el equipo de inspectores, y que además obedece a que las inspecciones se realizan conforme al marco normativo vigente al momento de la inspección, independientemente de que su resolución administrativa (desahogos, sanciones, juicios, amparos, etc) se realicen más adelante en el tiempo, incluso cuando ya hay otro marco normativo vigente. Y esto es muy importante, no solo para evitar el conteo repetido, sino para evitar la incorporación de información incompleta (procedimientos posteriores a la copia de la instancia que no se actualizaron en cualquier otra instancia posterior a la original).</p>
</div>
<div id="aplicacionModIV" class="section level4 unnumbered hasAnchor">
<h4>Aplicación de scripts<a href="a-tibble-32-11.html#aplicacionModIV" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Hay un único script que se ejecuta; se llama <em>query_violaciones_inspecciones_v.R</em>. Contiene los siguientes elementos:</p>
<ul>
<li><p>Se define una función (f.query ) que recorre las diferentes instancias de la base de datos, consultando una tabla específica en cada una de ellas y combinando los resultados en una única tabla que se devuelve como resultado.</p></li>
<li><p>Se define otra función (f.slice_base) que toma un data frame, lo ordena por la columna “base”, agrupa el data frame por una variable de agrupación (por ejemplo podría ser inspeccion_id) y posiblesmente otras variables adicionales (como argumentos adicionales opcionales en la función) seleccionando la primera fila de cada grupo y devuelve el data frame resultante con las filas seleccionadas</p></li>
<li><p>Se leen catálogos específicos de la inspección, en particular: el catálogo del tipo de inspección (entidad <em>tipo_inspeccion</em>), el subtipo de inspeccion (<em>subtipo_inspeccion</em>), el catálogo de inspectores participantes (inspec_participantes) y participantes en general (<em>participantes</em>), así como el <em>DNE_plus</em> (notando que como el DNE no tiene un buen registro histórico de movimientos, no es posible conocer las características de los CT al momento de la inspección y se asumen constantes a lo largo del tiempo).</p></li>
<li><p>Se construye el índice de inspecciones, conforme al criterio mencionado anteriormente.</p></li>
<li><p>Se construye el historial de violaciones detectadas por todas las inspecciones. Esto es una consulta bastante compleja que se reduce, muy sintéticamente, a las siguientes características:</p>
<ul>
<li><p>La consulta construye los siguientes campos:</p>
<ul>
<li><p>inspeccion_id: ID de inspección.</p></li>
<li><p>dshgo_tipo_desahogo: Tipo de desahogo.</p></li>
<li><p>materia_id: ID de materia.</p></li>
<li><p>submateria_id: ID de submateria.</p></li>
<li><p>nind: Número de indicadores.</p></li>
<li><p>nvio: Número de violaciones.</p></li>
<li><p>nvio_procede: Número de violaciones que proceden.</p></li>
<li><p>base: base de la cual se consulta (expresado numéricamente)</p></li>
</ul></li>
<li><p>Luego se realizan las siguientes consultas:</p>
<ul>
<li><p>Se recupera el id de la submateria de inspección.</p></li>
<li><p>Se cuenta el número de registros en las tablas <em>desahogo</em>, <em>dshgo_revision</em>, <em>dshgo_alcance</em> e <em>indicador</em> que cumplen la condición de la <em>inspeccion_id</em> de la tabla <em>inspeccion</em> sea igual a la <em>inspeccion_id</em> de <em>desahogo</em>, el <em>dshgo_tipo_desahogo</em> sea de valor 1 a 4, y varios campos estén relacionados entre las tablas. El resultado se almacena en la columna <em>nind</em>.</p></li>
<li><p>Se cuenta el número de registros en las mismas tablas mencionadas anteriormente, pero con condiciones adicionales. Por ejemplo, se verifican las relaciones entre las tablas y que el campo <em>cviol_procede</em> de la tabla <em>calif_violacion</em> sea igual a 1. El resultado se almacena en la columna <em>nvio</em>.</p></li>
<li><p>Se cuenta el número de violaciones que proceden imponiendo la condición adicional de que de la tabla <em>violaciones</em> la columna c<em>viol_procede</em> sea igual a 1. El resultado se almacena en la columna <em>nvio_procede</em></p></li>
</ul></li>
<li><p>Se combinan las tablas y agrupan los resultados según la <em>inspeccion_id</em>, <em>dshgo_tipo_desahogo</em> y <em>submateria_id</em>. Finalmente, los resultados se ordenan por <em>inspeccion_id</em> y como todo esto se realiza para cada una de la instancias de la base de datos, se agrega una columna que refleja qué número de instancia es.</p></li>
</ul></li>
<li><p>Tomando como referencia el índice de inspecciones construido anteriormente, se recupera la información del historial de violaciones, los catálogos de tipos y subtipos de inspección, los inspectores y demás participantes y los centros de trabajo.</p></li>
<li><p>El resultado de este procedimiento de almacena como <em>historico_inspecciones_v</em>.Rds</p></li>
</ul>
<p>Posibles problemas específicos en la aplicación de scripts</p>
<p>El principal problema es el acceso a las bases de datos en SQL Server del SIAPI-SIPAS, a la vez que se presenta un riesgo menor de que se realicen cambios sustantivos en la estructura de las bases de datos.</p>
<p>Frecuencia de actualización y propuesta de calendarización</p>
<p>Se recomienda realizar esta rutina cada vez que se requiera entrenar el modelo, a fin de incorporar la información más reciente sobre las inspecciones realizadas</p>
<p>Outputs Productos resultado de la ejecución de actividades</p>
<p>El resultado de este procedimiento de almacena como <em>historico_inspecciones_v</em>.Rds</p>
</div>
</div>
<div id="procesamientoModIVindicadores" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Construcción de la serie histórica de indicadores laborales<a href="a-tibble-32-11.html#procesamientoModIVindicadores" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>La segunda parte del módulo IV es la construcción de la serie histórica de los indicadores laborales que harán parte de las características de los centros de trabajo para predecir su probabilidad de encontrar violaciones laborales a nivel submateria.</p>
<p>Estos indicadores son los mismos del módulo I, es decir, usan el mismo método de cálculo y estructura, la única diferencia es que no se calculan de manera trimestral sino de manera anual, tomando uno o más periodos de referencia para construir un solo dato anual por indicador y agregación.</p>
<p>Todos los indicadores que se calculan de manera histórica se pueden identificar en el catálogo de indicadores por la columna “entra al modelo” cuando están marcados como “si”. Cabe resaltar que los indicadores que se calculan de manera coyuntural en el módulo I pero no de manera histórica en el módulo IV no entran como variables predictivas al modelo, y se utilizan sólo para caracterizar el centro de trabajo en la MPR (este es el caso de los indicadores del Censo Económico y el indicador <em>“ing_min”</em> de la ENOE),</p>
<p>A continuación se detallan los procesos de construcción de las series históricas por fuente de información: ENOE e IMSS.</p>
<div id="procesamientoModIVENOE" class="section level4 unnumbered hasAnchor">
<h4>Indicadores históricos de la ENOE<a href="a-tibble-32-11.html#procesamientoModIVENOE" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="inputenoehist" class="section level5 unnumbered hasAnchor">
<h5>Entradas - Inputs<a href="a-tibble-32-11.html#inputenoehist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p><strong>La tabla de indicadores histórico de la ENOE contiene todos los indicadores de la ENOE que entran como predictores al modelo, con estimaciones puntuales anuales calculadas para los diferentes niveles de agregación de 2012 a 2013.</strong> La tabla puede ser producida de dos formas distintas, llegando al mismo resultado: Una primera forma es calculando todos los indicadores desde el año 2012 al año más reciente (en este caso, 2023) a partir de las bases originales de la ENOE en formato .dbf únicamente del primer trimestre de cada año. Si se decide por esta construcción se debe tener en cuenta que el cálculo tomará alrededor de una semana para calcular 9 indicadores durante 10 años.</p>
<p><strong>O bien, la segunda forma, completando o nutriendo una tabla de indicadores históricos de la ENOE que haya sido calculada con anterioridad</strong>. Es decir, actualizando el compendio histórico que se incluye en la transferencia original del SIDIL. Para esta segunda opción se detectarán, primero, si están disponibles los insumos calculados de manera coyuntural, si es así, se añaden a la tabla de indicadores y se guarda la nueva versión actualizada. Si no se encuentran insumos en los resultados coyunturales, se buscan las bases originales de la ENOE posteriores al último periodo disponible de la tabla que se quiere actualizar, se construyen los indicadores y se añaden a la tabla, guardando una nueva versión actualizada de la misma.[^21]</p>
<p>En ambos casos se utilizan los datos correspondientes al primer trimestre de cada año, esto debido a que: 1) el corte de la serie histórica debe ser anual para poderlos imputar con esta temporalidad a la tabla del historial de inspecciones y, 2) todos los indicadores deben estar disponibles (sin valores faltantes), incluyendo aquellos que se calculan únicamente en el cuestionario ampliado del primer trimestre de cada año.</p>
</div>
<div id="aplicacionenoehist" class="section level5 unnumbered hasAnchor">
<h5>Aplicación de script<a href="a-tibble-32-11.html#aplicacionenoehist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>La construcción de la serie histórica de indicadores de la ENOE se realiza a partir de tres tipos de scripts que generan un único archivo .Rds con todas las estimaciones puntuales de todos los indicadores de la ENOE de los primeros trimestres desde el año 2012 hasta el año más reciente disponible.</p>
<p>Para producir la serie histórica de indicadores de la ENOE se utiliza la misma cantidad y tipos de scripts que el módulo I, ajustados para realizar el cálculo histórico.</p>
<p>Al igual que en la actualización coyuntural, para producir la serie histórica de indicadores de la ENOE se utiliza un script secuenciador, el cual hace uso del script de configuración inicial (sección 3.3.1), posteriormente ejecuta el script de Extracción y Transformación, el cual genera la base única de 2012 a 2023; y finalmente, ejecuta los scripts de cálculo de indicadores. El resultado de las estimaciones a través de los años y las agregaciones se guarda en una sola tabla que contiene todas las estimaciones puntuales de la ENOE. A continuación se detallan los procesos que realiza cada script:</p>
<ul>
<li><em>Script secuenciador (1 script):</em> Este script secuenciador llama y ejecuta el script de configuración inicial, así como a todos los scripts descritos en esta sección. El script inicia con el llamado y ejecución del script de configuración inicial y con la escritura del log. Posteriormente se define el objeto “actualizar_insumo”, el cual, si es igual a <em>True</em> o verdadero, toma la última versión de la tabla de indicadores históricos de la ENOE y la actualiza con los últimos insumos disponibles, bien sea obteniendo los indicadores de las tablas calculadas de manera coyuntural o, si no encuentra ningún insumo disponible allí, calculándolos a partir de las tablas originales de la ENOE para los años correspondientes.</li>
</ul>
<p>Si este objeto es falso o <em>False</em> generará la tabla de indicadores históricos desde cero, a partir de los cuestionarios originales de la ENOE desde el año 2012 al último año disponible. Por default se dejará el objeto actualizar_insumo==TRUE, por lo que se actualizará la tabla de indicadores históricos de la ENOE que se entregará a la STPS.<br />
Después de definir si se va a actualizar el último insumo o si se hará todo el proceso desde cero, se llama y corre el script de extracción y transformación, posteriormente se genera una lista con los indicadores que entran al modelo a partir del catálogo de indicadores, la cual es la base para llamar los scripts que generan cada indicador. Finalmente, se genera el resultado final: una tabla .Rds con todos los indicadores calculados de manera histórica desde 2012 hasta el último año disponible.</p>
<ul>
<li><em>Script de extracción y transformación (1 script):</em> Este script extrae y transforma las bases de datos originales (bien sea desde el 2012 o solo las correspondientes para actualizar el último insumo) para generar una sola base de datos con la información necesaria para el cálculo de los indicadores. La base resultante contiene la información relativa a la población trabajadora subordinada y remunerada del primer trimestre de cada año. Para minimizar el uso de la memoria de las computadoras, esta nueva base de datos generada no se guarda en la memoria de manera permanente.</li>
</ul>
<p><em>Scripts de generación de indicadores (10 scripts):</em> Estos scripts toman la base transformada para generar cada uno de los indicadores (un script por indicador) con sus respectivas estimaciones puntuales para los diferentes niveles de agregación por año. Estos scripts generan un archivo .Rds cada uno, los cuales posteriormente serán almacenados en la memoria de la computadora o el servidor con el nombre del indicador y la fecha de generación. Estos archivos posteriormente serán apilados en una sola tabla .Rds. Este paso no se realiza si se encuentra que los indicadores fueron calculados anteriormente de manera coyuntural.</p>
</div>
<div id="problemasenoe" class="section level5 unnumbered hasAnchor">
<h5>Posibles problemas específicos en la aplicación de script<a href="a-tibble-32-11.html#problemasenoe" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Los posibles problemas que pueden surgir al ejecutar los scripts están principalmente relacionados con los insumos y con la definición del objeto ““actualizar_insumo”. Si se deja la opción predeterminada, es decir, actualizar_insumo==TRUE se debe tener la tabla de indicadores históricos con el nombre y la ubicación correcta, además, se deben tener las tablas originales de la ENOE con los años que se deseen actualizar en los insumos originales en formato .dbf; o bien, se deben tener las tablas de indicadores calculados de manera coyuntural completas.</p>
<p>Si se cambia el objeto a FALSE, se deben tener todas las tablas originales de la ENOE en formato .dbf para cada primer trimestre del año, desde el año 2012 al año más reciente disponible. Hay que recordar que, al igual que el matching coyuntural, las tablas originales de la ENOE que se requieren son: COE1, COE2 y SDEM.</p>
<p>Otro problema que puede surgir de la aplicación de los scripts está relacionado con la disponibilidad de los scripts de los indicadores. Con el SIDIL se entregarán a la Secretaría diez (10) scripts de indicadores históricos de la ENOE, los cuales realizan el mismo cálculo que a nivel coyuntural, pero incluyendo la temporalidad anual a las iteraciones del cálculo.</p>
</div>
<div id="outputenoehist" class="section level5 unnumbered hasAnchor">
<h5>Salidas - Outputs Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputenoehist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El script secuenciador genera el resultado final o <em>output</em> de esta sección es una tabla .Rds con las estimaciones puntuales de todos los indicadores de la ENOE calculados desde el año 2012 hasta el primer trimestre del último año disponible. Este archivo se aloja en la carpeta de resultados históricos de la ENOE ((\3_resultados\historico\res_hist_ENOE). El archivo final tiene la siguiente estructura de nombre: “<em>enoe_historico_2023_v”</em>. En el ejemplo anterior, el 2023 se refiere al último periodo calculado de la serie histórica, mientras que la v se refiere al versionado que fue generado.</p>
<p>De ser necesario, el script secuenciador generará resultados intermedios por cada indicador, los cuales contienen las estimaciones puntuales de cada indicador para todos los años. Estos resultados intermedios se alojan en la carpeta de resultados históricos de la ENOE (\3_resultados\historico\res_hist_ENOE) en carpetas con el nombre de cada indicador. Es importante resaltar que estos outputs no se producen si se encuentran los inputs ya calculados de manera histórica.</p>
</div>
</div>
<div id="procesamientoModIVIMSS" class="section level4 unnumbered hasAnchor">
<h4>Indicadores históricos del IMSS<a href="a-tibble-32-11.html#procesamientoModIVIMSS" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En esta sección se ofrecen detalles acerca de la construcción de la serie histórica de indicadores calculados a partir de los registros administrativos del IMSS. Como podrá apreciarse, guarda mucha similitud con la explotación coyuntural de esta fuente de información.</p>
<div id="inputimsshist" class="section level5 unnumbered hasAnchor">
<h5>Entradas - Inputs<a href="a-tibble-32-11.html#inputimsshist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Los principales inputs para la generación de los indicadores históricos del IMSS son, naturalmente, los insumos originales de los registros administrativos. En consulta con la DGIEt se han incorporado los registros patronales, de asegurados y de accidentes (riesgos) reportados al IMSS de enero 2019 en adelante. Si estuvieran disponibles los registros administrativos anteriores a esa fecha tendría que verificarse que para cuatro de los 6 indicadores exista tanto la tabla de patrones como la de puestos, así como la de accidentes (riesgos) y patrones para la construcción de los otros dos indicadores. Esto porque, como se detalló anteriormente, es necesario combinar de esa manera estas tablas para la construcción de los indicadores.</p>
</div>
<div id="aplicacionimsshist" class="section level5 unnumbered hasAnchor">
<h5>Aplicación de scripts<a href="a-tibble-32-11.html#aplicacionimsshist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Hay cierta economía de escala en la construcción histórica de los indicadores del IMSS, a saber:</p>
<ul>
<li><p>Al igual que en la ENOE, se puede optar por una reconstrucción de principio a fin de los indicadores, o bien, únicamente incluir los valores adicionales que estuvieran faltando.</p></li>
<li><p>El principal script del IMSS en el módulo I es prácticamente el mismo que el script en el módulo IV, siendo la única diferencia la configuración de los parámetros.</p></li>
</ul>
<p>A su vez, respecto a la ENOE, la construcción de la serie histórica guarda una diferencia sustantiva: si bien la construcción de la estimación puntual también se realiza a nivel anual (un único valor para una unidad de observación para todo un año), la construcción de ésta es a partir de un promedio (según el caso, ponderado) de los promedios móviles trimestrales, como puede interpretarse a partir de los siguientes detalles.</p>
<p>Para la generación de los seis indicadores provenientes del IMSS aquí nuevamente se cuenta con tres tipos de scripts en formato .R, todos ellos gestionados desde el principal de ellos, el script secuenciador. Notar que a continuación sólo se destacarán las principales diferencias respecto al cálculo coyuntural de estos indicadores, a efectos de no repetir información.</p>
<p><strong>Script secuenciador (1 script)</strong>: La ejecución de este script se realiza con la siguiente configuración de parámetros:</p>
<ul>
<li><p>El parámetro <em>muestra</em> viene de manera predeterminada en FALSE</p></li>
<li><p>El parámetro <em>solo_adicionales</em>: para evitar que se recalculen <em>todos</em> los <em>años</em>, este se deja en TRUE. Así, este parámetro permite actualizar el SIDIL más rápido, sin necesidad de volver a calcular todo lo preexistente.</p></li>
<li><p>El parámetro <em>coyuntural:</em> en este caso siempre debe estar en FALSE</p></li>
<li><p>El parámetro: <em>filtrado_master_et_periodo</em> definido en FALSE.</p></li>
<li><p>El parámetro <em>periodos_backward</em> se fija de manera automática</p></li>
<li><p>El parámetro <em>frecuencia_actualizacion:</em> Es indistinto, queda sin efecto si coyuntural es FALSE</p></li>
<li><p><em>nro_periodos_hacia_atras:</em> predefinido en 2.</p></li>
<li><p><em>El parámetro sinkmode, así como se describe en la sección anterior de la ENOE</em></p></li>
<li><p><em>El parámetro val_referencia:</em> queda sin efecto si coyuntural es FALSE</p></li>
</ul>
<div class="figure"><span style="display:block;" id="fig:parametrosimsshist"></span>
<img src="images-1/important-icon.svg" alt="Configuración de parámetros del script secuenciador del IMSS para el cálculo histórico" width="50px" style="float:left; background-color: #f5f5f5; padding-right:1em" />
<p class="caption">
Recuadro 5.34: Configuración de parámetros del script secuenciador del IMSS para el cálculo histórico
</p>
</div>
<div class="rmdcomment">
<p>
Notar que de nueva cuenta se presentan configuraciones sugeridas,
quedando a disposición del usuario informado para realizar las
modificaciones necesarias
</p>
<ul>
<li>
<em>Escenario 1: Explotación histórica “completa”: se actualizan
todos los preprocesados y/o indicadores que no hayan sido calculados a
la fecha.</em>
</li>
</ul>
<p>
En este escenario se calculan todos los productos intermedios
(preprocesados, indicadores mensuales) y los productos finales (promedio
móvil) independitemente de que hayan sido calculados previamente (dado
solo_adicionales en FALSE). Se tomarán en cuenta los resultados
mensuales de los últimos dos meses anteriores al último mes disponible
(dado nro_periodos_hacia_atras) para el cálculo del promedio móvil. Los
resultados serán representativos (dado el valor de muestra). El
procedimiento será registrado en el log (dado sinkmode) y se realizarán
comparaciones contra los valores de referencia (dado
val_referencia).
</p>
<table>
<thead>
<tr class="header">
<th>
Parámetro
</th>
<th>
Valor predeterminado
</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>
<em>coyuntural</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="even">
<td>
<em>solo_adicionales</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>frecuencia_actualizacion</em>
</td>
<td>
<em>indistinto, no aplica</em>
</td>
</tr>
<tr class="even">
<td>
<em>filtrado_master_et_periodo</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>nro_periodos_hacia_atras</em>
</td>
<td>
<em>2</em>
</td>
</tr>
<tr class="even">
<td>
<em>muestra</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>sinkmode</em>
</td>
<td>
<em>TRUE</em>
</td>
</tr>
<tr class="even">
<td>
<em>val_referencia</em>
</td>
<td>
<em>indistinto</em>
</td>
</tr>
<tr class="odd">
<td>
<em>periodos_backward</em>
</td>
<td>
<em>automático</em>
</td>
</tr>
</tbody>
</table>
<ul>
<li>
<em>Escenario 2: Explotación histórica “eficiente” en cuanto a que
se actualizan sólo los adicionales pendientes</em>
</li>
</ul>
<p>
En este escenario, la única diferencia respecto al escenario
anteriores es la modificación a TRUE del parámetro
<em>solo_adicionales</em>. Esto hace que se calculen únicamente los
adicionales.
</p>
<table>
<thead>
<tr class="header">
<th>
Parámetro
</th>
<th>
Valor predeterminado
</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>
<em>coyuntural</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="even">
<td>
<em>solo_adicionales</em>
</td>
<td>
<em>TRUE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>frecuencia_actualizacion</em>
</td>
<td>
<em>indistinto, no aplica</em>
</td>
</tr>
<tr class="even">
<td>
<em>filtrado_master_et_periodo</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>nro_periodos_hacia_atras</em>
</td>
<td>
<em>2</em>
</td>
</tr>
<tr class="even">
<td>
<em>muestra</em>
</td>
<td>
<em>FALSE</em>
</td>
</tr>
<tr class="odd">
<td>
<em>sinkmode</em>
</td>
<td>
<em>TRUE</em>
</td>
</tr>
<tr class="even">
<td>
<em>val_referencia</em>
</td>
<td>
<em>indistinto</em>
</td>
</tr>
<tr class="odd">
<td>
<em>periodos_backward</em>
</td>
<td>
<em>automático</em>
</td>
</tr>
</tbody>
</table>
</div>
<p>El hecho de fijar <em>coyuntural</em> igual a FALSE incide directamente en las siguientes secciones del script secuenciador:</p>
<ul>
<li><p>2.1.3 y 4.0: que no se calcularán valores de referencia</p></li>
<li><p>4.1.2: no se limitará la explotación de insumos preprocesados</p></li>
<li><p>5: si solo_adicionales también es FALSE: se recorrerán todos los meses hacia atrás y secuencialmente se calculará el promedio móvil para cada uno de ellos</p></li>
<li><p>6: se actualizará el acumulado histórico con los promedios anuales calculados a partir de los promedio móviles.</p></li>
</ul>
</div>
<div id="frecuenciaimsshist" class="section level5 unnumbered hasAnchor">
<h5>Frecuencia de actualización y propuesta de calendarización<a href="a-tibble-32-11.html#frecuenciaimsshist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Este script debe ser ejecutado previo al matching histórico, mismo que a su vez debe suceder previo al entrenamiento del modelo</p>
</div>
<div id="outputimsshist" class="section level5 unnumbered hasAnchor">
<h5>Outputs Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputimsshist" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>El principal resultado de este script son dos tablas con el acumulado histórico de indicadores anuales. Una de ellas es la tabla IMSS_AGREGADO_historico_ que incluye las estimaciones por nivel de agregación. La otra es la tabla IMSS_NOMINATIVO_historico_ que contiene el promedio anual a nivel registro patronal. Ambas son tablas en formato Rds que luego explotará el script de matching histórico.</p>
</div>
</div>
</div>
<div id="procesamientoModIVmatching" class="section level3 hasAnchor" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> Matching de las series históricas<a href="a-tibble-32-11.html#procesamientoModIVmatching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Después de generar las tablas de las series históricas de los indicadores y del historial de inspecciones se debe realizar el matching entre los conjuntos de datos. El objetivo del matching histórico es imputar a los centros de trabajo que fueron inspeccionados los indicadores calculados, ya sea a nivel nominativo (para los indicadores del IMSS cuando aplique) o por nivel de agregación, según el año de inspección.</p>
<p>Esta imputación se diferencia de la coyuntural en que toma en cuenta la temporalidad y la unidad de observación. La base del histórico de inspecciones tiene como unidad de observación las inspecciones, de esta manera, el matching histórico se realiza utilizando, además de las características del centro del trabajo al que se le realizó la inspección, el año en que ésta fue realizada, para así imputarle los indicadores de dicho año.</p>
<div id="inputmatchhist" class="section level4 unnumbered hasAnchor">
<h4>Entradas - Inputs<a href="a-tibble-32-11.html#inputmatchhist" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los insumos o inputs necesarios para realizar el matching son:</p>
<ul>
<li><p>Tabla de indicadores históricos de la ENOE</p></li>
<li><p>Tabla de indicadores históricos del IMSS por agregación</p></li>
<li><p>Tabla de indicadores históricos del IMSS a nivel nominativo</p></li>
<li><p>Tabla de inspecciones históricas</p></li>
</ul>
<p>Estas tablas son generadas en los procesos anteriormente descritos (partes 2 y 3 módulo IV) y guardadas en formato .Rds.</p>
<p>Asimismo, son necesarios los catálogos de indicadores y de niveles de agregación guardados en las carpetas de insumos correspondientes.</p>
</div>
<div id="appmatchhist" class="section level4 unnumbered hasAnchor">
<h4>Aplicación de script<a href="a-tibble-32-11.html#appmatchhist" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El script de matching histórico está desarrollado en formato Python y cuenta con la siguiente estructura en el nombre: <em>4_matching_historico_aaaa_mm_dd.py</em></p>
<p>Este script identifica las últimas versiones de las cuatro tablas que necesita de insumo y las carga junto con los catálogos correspondientes. Posteriormente, genera el matching histórico nominativo a partir de la variable “ct_registro_imss” y año.</p>
<p>Es importante resaltar que, ya que los indicadores históricos del IMSS se encuentran disponibles únicamente desde el año 2019, la imputación o matching de estos indicadores a las inspecciones realizadas antes del 2019 se hace con las estimaciones puntuales de dicho año, representando el valor más antiguo en el tiempo. Esto aplica tanto a nivel nominativo como por agregación y únicamente para los indicadores del IMSS, no para los de la ENOE.</p>
<p>Finalmente, el script realiza el matching por nivel de agregación de indicadores de la ENOE y para aquellos del IMSS que no fueron imputados de manera nominativa.</p>
<p>Este proceso genera una tabla .Rds cuyas observaciones son el total de inspecciones históricas (mismo número de filas que la tabla del histórico de inspecciones), y con columnas de tipo:</p>
<ul>
<li><p>Campos de identificación de la inspección y del centro de trabajo</p></li>
<li><p>Campos de características de la inspección y del centro de trabajo</p></li>
<li><p>Campos de indicadores (IMSS y ENOE)</p></li>
</ul>
</div>
<div id="problemasmatchhist" class="section level4 unnumbered hasAnchor">
<h4>Posibles problemas específicos en la aplicación de scripts<a href="a-tibble-32-11.html#problemasmatchhist" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Al igual que en las otras partes del módulo, los principales problemas que se puedan presentar están relacionados con los insumos que utiliza el código. Es importante mantener la misma estructura de las tablas, el nombre y el lugar de guardado correctamente. También se enfatiza en que, si se realiza algún cambio en los datos, no olvidar reflejarlo en los catálogos correspondientes, ya que todos los códigos a lo largo de los módulos lo utilizan.</p>
</div>
<div id="outputmatchhist" class="section level4 unnumbered hasAnchor">
<h4>Outputs Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#outputmatchhist" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Es resultado o output principal es una tabla en formato .Rds con tantas número de filas como número de inspecciones del input del historial de inspecciones, y con filas de distinto tipo:</p>
<ul>
<li><p>Identificación: Campos identificadores de cada inspección y del centro de trabajo.</p></li>
<li><p>Atributos: Campos de atributos de los centros de trabajo y de la inspección</p></li>
<li><p>Indicadores: Campos de indicadores de la ENOE e IMSS que entran al modelo.</p></li>
</ul>
</div>
</div>
<div id="procesamientoModIVEntrenamiento" class="section level3 hasAnchor" number="5.4.5">
<h3><span class="header-section-number">5.4.5</span> Entrenamiento y evaluación del modelo de predicción<a href="a-tibble-32-11.html#procesamientoModIVEntrenamiento" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Una vez realizado el matching histórico se puede generar el entrenamiento del modelo predictivo y su respectiva evaluación</strong>. El modelo genera una probabilidad de cometer violaciones laborales en cada una de las submaterias seleccionadas, así como una predicción conjunta de riesgo de cometer alguna violación en cualquier submateria, esto para cada uno de los centros de trabajo. Las probabilidades van de 0 a 1 para ser interpretadas en términos porcentuales. El modelo predeterminado que se entrena es un modelo Random Forest, aunque también se deja configurada la opción de que se entrene un modelo Tabnet.</p>
<div class="figure"><span style="display:block;" id="fig:modelos"></span>
<img src="images-1/important-icon.svg" alt="Modelos Random Forest y Tabnet" width="50px" style="float:left; background-color: #f5f5f5; padding-right:1em" />
<p class="caption">
Recuadro 5.35: Modelos Random Forest y Tabnet
</p>
</div>
<div class="rmdcomment">
<ul>
<li>
<strong>Random Forest o bosque aleatorio:</strong>
</li>
</ul>
<p>
Es un modelo que crea un conjunto de árboles de decisión
independientes entre sí para solventar problemas de clasificación y
regresión en aprendizaje automático. Cada árbol se entrena en una
muestra aleatoria del conjunto de datos de entrenamiento y utiliza solo
un subconjunto aleatorio de características (features, o variables
input) para realizar divisiones en los nodos del árbol. Estos
subconjuntos aleatorios y el uso de múltiples árboles permiten que el
modelo Random Forest capture una variedad de patrones y relaciones en
los datos, promediando todos los resultados para obtener una predicción
final. Una de las ventajas del modelo Random Forest es su capacidad para
manejar conjuntos de datos grandes y complejos, su capacidad para
manejar datos categóricos y numéricos, su resistencia al sobreajuste y
su rendimiento robusto en una variedad de problemas de aprendizaje
automático.
</p>
<ul>
<li>
<strong>TabNet:</strong>
</li>
</ul>
<p>
TabNet es un modelo de aprendizaje automático basado en redes
neuronales pero diseñado específicamente para abordar problemas de
aprendizaje automático en datos tabulares, como conjuntos de datos
estructurados o tablas. TabNet utiliza una operación de atención en cada
capa (es decir, asignar diferentes pesos o niveles de importancia a
diferentes elementos o partes de la entrada) para seleccionar y ponderar
características relevantes en función de la tarea de predicción, esto
permite al modelo aprender de manera más eficiente a partir de datos
tabulares y capturar relaciones no lineales complejas entre las
características. TabNet ha demostrado ser de utilidad en distintas
tareas de aprendizaje automático en datos tabulares, incluyendo
clasificación, regresión y tareas de series de tiempo.
</p>
</div>
<div id="inputentrenamiento" class="section level4 unnumbered hasAnchor">
<h4>Entradas - Inputs<a href="a-tibble-32-11.html#inputentrenamiento" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>El principal insumo necesario para generar el entrenamiento y posterior evaluación del modelo de predicción de riesgo es la tabla resultado del matching coyuntural. También se utilizan diversos catálogos.</p>
<p>Además, para generar la evaluación es necesario instalar la herramienta “Graphviz” para visualizar el reporte de modelo en formato HTML.</p>
</div>
<div id="aplicación-de-scripts" class="section level4 hasAnchor" number="5.4.5.1">
<h4><span class="header-section-number">5.4.5.1</span> Aplicación de scripts<a href="a-tibble-32-11.html#aplicación-de-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>La Parte 4 está dividida en dos scripts: el script de entrenamiento y el script de evaluación. Ambos scripts están desarrollados en lenguaje Python, los cuales pueden ser ejecutados desde la CMD o desde RStudio.</p>
<ul>
<li><p>El script de entrenamiento del modelo tiene las siguientes partes:</p>
<ol style="list-style-type: decimal">
<li><p>Llamado de paqueterías</p></li>
<li><p>Funciones de configuración, entre las que se encuentran procesos como la definición de rutas, definición de fecha y hora, de apertura de log, tamaño de <em>chunk</em><a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>, entre otros.</p></li>
<li><p>Definición de funciones operativas, entre las que se encuentran la escritura del log, renombrar columnas, función para carga de archivos .Rds y .csv, función para identificar las variables de entrada al modelo, función de muestreo, entre otras.</p></li>
<li><p>Definición de las submaterias sobre las cuales se hará la predicción a partir del catálogo de submaterias. La selección de submaterias se realiza teniendo en cuenta los indicadores calculados (como variables latentes de las submaterias) y el número de inspecciones que se hayan realizado de estas submaterias (se sugiere que haya por lo menos 300 inspecciones en el historial de inspecciones). Teniendo en cuenta esto, las inspecciones seleccionadas hacen parte de la materia de Condiciones Generales de Trabajo (ver cat_submaterias). Además de las predicciones por submateria, se realiza un entrenamiento de predicción general para todas las submaterias (y todas las materias).</p></li>
<li><p>Lectura y transformación del último insumo disponible del Universo de Inspecciones con Indicadores (resultado de la parte 3 de este módulo).</p></li>
<li><p>Definición de las variables de entrada al modelo. En esta sección se consultan los catálogos de niveles de agregación, de indicadores y de campos del DNE para identificar las variables que entran al modelo. Posteriormente, se verifica que todas las variables indicadas en los catálogos existan en el insumo del histórico de inspecciones con indicadores.</p></li>
<li><p>Preparación de la base para el entrenamiento del modelo, donde se estandarizan las variables, se realiza un muestreo aleatorio (también se brinda la posibilidad de que dicho muestreo sea por fecha de inspección), se hace un <em>pivot</em> o trasposición de la base, se reemplazan los valores faltantes e infinitos por -1 (ya que no es un valor válido para la predicción, como si lo es el 0), se generan objetos tipo <em>array</em> que contienen las variables a predecir tanto para la predicción por submateria como para la predicción general, entre otros procedimientos.</p></li>
<li><p>Una vez se tienen las bases de datos listas, se inicia el &gt; entrenamiento del modelo. Primero se selecciona el modelo que se &gt; quiere entrenar, puede ser Random Forest o TabNet. Para &gt; seleccionar Random Forest, en la sección 8.1, el parámetro &gt; “model_number” debe ser igual a 1 (model_number = ‘1’), para &gt; seleccionar el modelo TabNet, el parámetro “model_number” debe ser &gt; igual a 2 (model_number = ‘2’). Se dejará preseleccionado el &gt; modelo Random Forest.Posteriormente, se divide la base 4 objetos <em>array</em>, dos que contienen las variables de entrada (con el nombre “x_…”) y dos que contienen la variable objetivo (con el nombre “y_…”). Cada par será utilizado para el entrenamiento y para el test.</p>
<p>a. Random Forest: Primero se generan los archivos .txt y .pkl que albergarán los resultados del modelo, los cuales serán utilizados &gt; en la predicción. Estos son:</p>
<ul>
<li><p>sub_test_rf\_(fecha).txt: Contiene las submaterias sobre las cuales se harán las predicciones</p></li>
<li><p>score_test_rf\_(fecha).txt: Contiene una medida de confianza de las predicciones para cada submateria</p></li>
<li><p>rf_clf\_(fecha).pkl: Contiene los elementos del modelo entrenado de clasificación (predicción por submaterias)</p></li>
<li><p>rd_regr\_(fecha).pkl: Contiene los elementos del modelo entrenado de regresión (predicción general).</p>
<p>Posteriormente, se entrenan los dos modelos:</p>
<ol style="list-style-type: decimal">
<li><p>El modelo predictivo para cada una de las submaterias: Se genera el objeto ‘regr’ creando un clasificador de bosque aleatorio dentro de la clase MultiOutputClassifier. Esto permite que el clasificador pueda manejar múltiples variables objetivo (en este caso, submaterias) en lugar de solo una. De esta manera, el modelo resultante realiza predicciones simultáneas para cada submateria. El parámetro “n_jobs=-1” indica que se utilizarán todos los núcleos del procesador disponibles para entrenar los árboles en paralelo, lo que acelera el proceso de entrenamiento. Posteriormente, se aplica el modelo utilizando las variables de entrada (“x_regr…”) y la variable objetivo (“y_regr…”).</p></li>
<li><p>El modelo predictivo general para todas las submaterias: se genera el objeto ‘clf’ creando un clasificador de bosque aleatorio utilizando la clase RandomForestClassifier. con una profundidad máxima de 3 (“max_depth=3”), manejo automático de desequilibrios de clases (“class_weight=‘balanced’”) y utilizando todos los núcleos del procesador disponibles (“n_jobs=-1”). Posteriormente, se aplica el modelo utilizando las variables de entrada (“x_clf…”) y la variable objetivo (“y_clf…”).</p></li>
</ol>
<p>Luego, se generan las predicciones utilizando los modelos ‘regr’ y ‘clf, utilizando el método “predict_proba”, el cual devuelve las probabilidades de predicción para cada clase. El objeto “y_pred_regr” contendrá las predicciones del modelo ’regr’, mientras que “y_pred_clf” contendrá las probabilidades de predicción del modelo ‘clf’. Finalmente se guardan los resultados en los archivos .pkl y .txt creados anteriormente.</p></li>
</ul></li>
</ol>
<!-- -->
<ol start="2" style="list-style-type: lower-alpha">
<li><p>TabNet: Primero se generan los archivos .txt y .pkl que albergarán los resultados del modelo, los cuales será utilizados en la &gt; predicción. Estos son:</p>
<ul>
<li><p>sub_test_tn\_(fecha).txt: Contiene las submaterias sobre las cuales se harán las predicciones</p></li>
<li><p>score_test_tn\_(fecha).txt: Contiene una medida de confianza de las predicciones para cada submateria</p></li>
<li><p>tabnet_model_1\_(fecha).pkl: Contiene los elementos del modelo entrenado de clasificación (predicción por submaterias)</p></li>
<li><p>tabnet_model_1\_(fecha).pkl: Contiene los elementos del modelo entrenado de regresión (predicción general).</p>
<p>Posteriormente, se entrenan los dos modelos:</p>
<ol style="list-style-type: decimal">
<li>El modelo predictivo para cada una de las submaterias: Se genera el objeto “regr” con un modelo un modelo de regresión basado en la arquitectura de red neuronal TabNet, utilizando la clase TabNetRegressor. Posteriormente, sen entrena el modelo modelo utilizando las variables de entrada (“x_regr…”) y la variable objetivo (“y_regr…”). Además, se evalúa el desempeño del modelo en un conjunto de datos de prueba proporcionado. Esto permite evaluar qué tan bien está generalizando el modelo y si está logrando buenos resultados en datos que no ha visto durante el entrenamiento.</li>
<li>El modelo predictivo general para todas las submaterias: se genera el objeto ‘clf’ con un modelo de clasificación basado en TabNet, utilizando la clase TabNetClassifier. Esta clase implementa la lógica y los métodos necesarios para entrenar y realizar predicciones utilizando el algoritmo de clasificación TabNet. Posteriormente, sen entrena el modelo modelo utilizando las variables de entrada (“x_clf…”) y la variable objetivo (“y_clf…”). Asimismo, se especifica el método de evaluación AUC (Área bajo la curva). El AUC es una métrica comúnmente utilizada en problemas de clasificación binaria para evaluar la calidad de un modelo de clasificación.</li>
</ol></li>
</ul>
<p>Luego, se generan las predicciones utilizando los modelos previamente entrenados. El objeto ‘y_pred_regr’ contendrá las predicciones del modelo de regresión ‘regr’, mientras que ‘y_pred_clf’ contendrá las probabilidades de predicción del modelo de clasificación ‘clf’. Finalmente se guardan los resultados en los archivos .pkl y .txt creados anteriormente.</p></li>
</ol>
<!-- -->
<ol start="9" style="list-style-type: decimal">
<li>Se guardan los resultados de la predicción y se ajusta el base &gt; resultado del riesgo total.</li>
<li>Se registra el proceso en las bitácoras correspondientes.</li>
<li>Cierre.</li>
</ol></li>
<li><p>El script de entrenamiento del modelo tiene las siguientes partes:</p>
<ol style="list-style-type: decimal">
<li>Generación de métricas de <em>performance</em> del modelo predictivo entrenado para los dos modelos, ya sea Random Forest o TabNet. En esta parte se generan dos tablas que se imprimirán en el log reportando las métricas de rendimiento del modelo, estas son[^23]:
<ul>
<li><p>Precisión (<em>accuracy</em>): La precisión es una medida de qué tan bien el modelo clasificador coincide con los datos reales y proporciona información sobre la exactitud general del modelo.</p></li>
<li><p>Puntaje de precisión (<em>precision score</em>): Es una métrica que mide la proporción de predicciones positivas correctas (verdaderos positivos) con respecto a todas las predicciones positivas realizadas por el modelo, es decir, cuán precisas son las predicciones positivas del modelo.</p></li>
<li><p>Sensibilidad o tasa de verdaderos positivos (<em>recall</em>): Es una medida que evalúa la capacidad de un modelo de clasificación para identificar correctamente las muestras positivas. El recall se centra en saber cuántos valores positivos fueron correctamente clasificados.</p></li>
<li><p>Puntaje F1 (<em>F1 Score</em>): Es una métrica que combina la precisión (precision) y el recall en una sola medida para evaluar el rendimiento de un modelo de clasificación. El F1 Score es una medida que oscila entre 0 y 1, donde 1 representa la mejor puntuación posible, indicando un equilibrio entre precisión y recall.</p></li>
<li><p>Puntaje AUC (<em>Area Under the Curve Score</em>): Es una métrica utilizada para evaluar el rendimiento de un modelo de clasificación binaria en un problema de clasificación. AUC mide la capacidad del modelo para distinguir entre clases positivas y negativas. El AUC Score representa el área bajo la curva ROC y varía entre 0 y 1. Un AUC Score de 1 indica un modelo perfecto que puede distinguir perfectamente entre las clases positivas y negativas, mientras que un AUC Score de 0.5 indica un modelo que realiza predicciones al azar.</p></li>
<li><p>Adicionalmente se presenta el nivel de confianza de toda la base.</p></li>
</ul></li>
</ol>
<!-- -->
<ol start="2" style="list-style-type: decimal">
<li>Generación del análisis Shapley, el cual mide la contribución relativa de cada característica o atributo en la predicción del modelo. El análisis se guarda en un archivo HTML y las gráficas en archivos .png.</li>
</ol></li>
</ul>
</div>
<div id="problemasentrenamiento" class="section level4 unnumbered hasAnchor">
<h4>Posibles problemas específicos en la aplicación de scripts<a href="a-tibble-32-11.html#problemasentrenamiento" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Los posibles problemas con la aplicación del script son los relacionados con los insumos. Debe estar disponible el insumo resultado del matching histórico, los catálogos y el complemento “GraphViz” para la generación del reporte Shapley en HTML. Asimismo, deben estar instaladas todas las librerías de Python necesarias para el funcionamiento del script (las cuales se encuentran en el archivo <em>requirements.txt</em>).</p>
<div class="figure"><span style="display:block;" id="fig:nuevassubmaterias"></span>
<img src="images-1/important-icon.svg" alt="Inclusión de submaterias para la predicción" width="50px" style="float:left; background-color: #f5f5f5; padding-right:1em" />
<p class="caption">
Recuadro 5.36: Inclusión de submaterias para la predicción
</p>
</div>
<div class="rmdcomment">
<p>
Incorporar nuevas submaterias para la predicción requiere tres
pasos:
</p>
<ul>
<li>
<p>
Verificar que haya antecedentes de inspección en dicha materia y
que estén reflejados en la consulta del histórico de
inspecciones
</p>
</li>
<li>
<p>
Incluir el id de la submateria en el listado de submaterias
registrado en sub_to_not_exclude.txt
</p>
</li>
</ul>
</div>
</div>
<div id="ouputentrenamiento" class="section level4 unnumbered hasAnchor">
<h4>Outputs Productos resultado de la ejecución de actividades<a href="a-tibble-32-11.html#ouputentrenamiento" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Son seis <em>outputs</em> o resultados esperados de esta sección:</p>
<ul>
<li><p>Un archivo .txt con el nombre <em>score_test_(rf o tn)_(fecha).txt</em> el cual contiene la métrica de confianza de la predicción de cada una de las submaterias. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento.</p></li>
<li><p>Un archivo .txt con el nombre <em>sub_test_(rf o tn)_(fecha).txt</em> el cual contiene el nombre de cada una de las submaterias sobre las cuales se entrenó el modelo. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento.</p></li>
<li><p>Un archivo .pkl con el nombre <em>(rf o tn)_regr_(fecha).pkl</em> el cual contiene los elementos del modelo entrenado para cada una de las submaterias. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento.</p></li>
<li><p>Un archivo .pkl con el nombre <em>(rf o tn)_clf_(fecha).pkl</em> el cual contiene los elementos del modelo entrenado para todas las submaterias en conjunto. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento.</p></li>
<li><p>Un archivo .pkl con el nombre <em>variables_entrenamiento _(fecha).pkl</em> el cual contiene las variables que se tomaron en cuenta para entrenar el modelo. Este archivo se alberga en la misma carpeta donde se encuentra el script de entrenamiento.</p></li>
<li><p>Un archivo .csv con el nombre <em>TrainingInspeccionesInd_(fecha).csv</em> el cual contiene todas las columnas con las que se entrenó el modelo, además de otros atributos, así como el riesgo conjunto de todas las submaterias para cada centro de trabajo. Este archivo se alberga en la carpeta de resultados.</p></li>
</ul>
<p>Todos estos archivos son necesarios para la aplicación del modelo en el <a href="#id_#procesamientoModIIIinterfazConsult">Módulo III</a>.</p>
<p>Adicionalmente, el script de evaluación genera los siguientes outputs:</p>
<ul>
<li><p>Log que contiene métricas de performance de los dos modelos entrenados</p></li>
<li><p>Reporte Shapley en formato HTML</p></li>
<li><p>Gráficas del reporte en formato .png</p></li>
<li><p>Si se entrenan los dos modelos, tablas comparativas entre los resultados de modelo Random Forest y de modelo Tabnet.</p></li>
</ul>
<div class="figure"><span style="display:block;" id="fig:shap"></span>
<img src="images-1/important-icon.svg" alt="Reporte Shapley" width="50px" style="float:left; background-color: #f5f5f5; padding-right:1em" />
<p class="caption">
Recuadro 5.37: Reporte Shapley
</p>
</div>
<div class="rmdcomment">
<p>
<u>El análisis Shapley se utiliza para comprender la contribución de
características individuales en un modelo de aprendizaje automático y
cómo afectan las predicciones del modelo. Dado que modelos como Random
Forest o TabNet no arrojan resultados de contribución a la predicción de
las variables de la misma manera que lo hace una regresión simple, por
ejemplo, el análisis Shapley se aplica con el fin de comprender cómo las
características individuales afectan las predicciones del
modelo.</u>
</p>
<p>
Al calcular los valores Shapley para cada característica, se obtiene
una medida de importancia relativa. Estos valores indican cuánto
contribuye cada característica a la predicción final. Este aporte se
puede medir y visualizar de diferentes maneras, entre ellas:
</p>
<ul>
<li>
<p>
SHAP Feature Importance: Promedio de los valores absolutos para
obtener una importancia global de cada uno de los atrbutos. Ejemplo:
</p>
<div class="float">
<img src="images-1/04/shapley1.png"
alt="Ejemplo SHAP Feature Importance" />
<div class="figcaption">
Ejemplo SHAP Feature Importance
</div>
</div>
</li>
<li>
<p>
Diagrama de resumen SHAP: Este diagrama combina la importancia de
las características con los efectos de las características. Cada punto
en la gráfica de resumen es un valor de Shapley para una característica
y una instancia. La posición en el eje y está determinada por la
característica y en el eje x por el valor de Shapley. El color
representa el valor de la característica de menor a mayor. Ejemplo:
</p>
<div class="float">
<img src="images-1/04/shapley2.png"
alt="Ejemplo Diagrama de resumen SHAP" />
<div class="figcaption">
Ejemplo Diagrama de resumen SHAP
</div>
</div>
</li>
<li>
<p>
Diagramas de cascada: Estos diagramas están diseñados para
mostrar explicaciones de predicciones individuales. La parte inferior
del diagrama comienza como el valor esperado o Treshhold de la salida
del modelo (<span class="math inline"><span class="math inline">\((E[f(X)]\)</span></span>) y luego cada
fila muestra cómo la contribución positiva (roja) o negativa (azul) de
cada característica mueve el valor de la salida esperada del modelo
sobre el conjunto de datos del modelo hasta alcanzar la predicción
(<span class="math inline"><span class="math inline">\((f(x))\)</span></span>). Ejemeplo:
</p>
<div class="float">
<img src="images-1/04/shapley3.png" alt="Ejemplo Diagrama de cascada" />
<div class="figcaption">
Ejemplo Diagrama de cascada
</div>
</div>
</li>
</ul>
<p>
Fuentes:
</p>
<ul>
<li>
<p>
MOLNAR, Chirstoph. Interpretable Machine Learning. A Guide for
Making Black Box Models Explainable, 2023-03-02. En internet: <a
href="https://christophm.github.io/interpretable-ml-book/"
class="uri">https://christophm.github.io/interpretable-ml-book/</a>
</p>
</li>
<li>
<p>
An introduction to explainable AI with Shapley values. En
internet: <a
href="https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html"
class="uri">https://shap.readthedocs.io/en/latest/example_notebooks/overviews/An%20introduction%20to%20explainable%20AI%20with%20Shapley%20values.html</a>
</p>
</li>
</ul>
</div>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>La sobre/simplificación obedece a que sólo se presentan algunas columnas, y unos pocos ejemplos (ficticios) de algunas posibles combinaciones de categorías dentro de algunos niveles de agregación.<a href="a-tibble-32-11.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Esto se relaciona al recuadro XXX en cuanto al método de cálculo de los valores representativos para las categorías SCIAN 2 32, 33 y 49.<a href="a-tibble-32-11.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Toda vez que en realidad esta tabla con todos los indicadores reunidos en un solo objeto no se genera por el SIDIL – no hay necesidad de ello. Además, no se presentan el nombre de los campos tal como se utilizan en el sistema, ni todos los campos fueron incluidos en esta ilustración.<a href="a-tibble-32-11.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Recordar que en este catálogo se determina la consulta en más de una entidad (tabla) del SQL Server, y la unión (merge o join) de las mismas requiere campos en común; es decir, hay campos intencionalmente duplicados (que están en diferentes tablas). Notar que a la cuenta de campos en el catálogo hay que quitarle aquellos duplicado para llegar al número total de columnas atributos que conforman el universo de CT con indicadores.<a href="a-tibble-32-11.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Se define como chunk las partes en las que se divide la tabla de datos para realizar los procesos necesarios de manera iterativa, esto con el fin de lograr mayor eficiencia al ejecutar los procesos con grandes cantidades de datos. Así, chunksize es la definición del tamaño de cada parte.<a href="a-tibble-32-11.html#fnref10" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="procesamiento.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="presentación-sintética-de-todos-los-scripts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdownproj.none"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
